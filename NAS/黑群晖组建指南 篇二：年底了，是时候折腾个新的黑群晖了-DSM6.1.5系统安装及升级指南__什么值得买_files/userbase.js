Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,o=Number(arguments[1])||0;for((o=o<0?Math.ceil(o):Math.floor(o))<0&&(o+=e);o<e;o++)if(o in this&&this[o]===t)return o;return-1});var zhiyou_relate={baseUrl:"//zhiyou.smzdm.com/",mBaseUrl:"//zhiyou.m.smzdm.com/",loginUrl:"https://zhiyou.smzdm.com/",iframe_url:"https://zhiyou.smzdm.com/user/login/window/#redirect_url=",init:function(){},getClient:function(){var t=navigator.userAgent,e=!1;return!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&/smzdmapp/i.test(t)&&/wkwebview/gi.test(t)&&(e=!0),e},gotChannelName:function(t){var e={"www.smzdm.com":"首页_","www.smzdm.com/p/":"商品详情_","post.smzdm.com":"原创_","post.smzdm.com/p/":"原创详情_","faxian.smzdm.com":"发现_","haitao.smzdm.com":"海淘_","2.smzdm.com":"闲值_","news.smzdm.com":"资讯_","news.smzdm.com/p/":"资讯详情_","search.smzdm.com":"搜索_","wiki.smzdm.com":"百科_","wiki.smzdm.com/p/":"百科_","test.smzdm.com":"众测_","test.smzdm.com/p/":"众测_","auto.smzdm.com":"汽车_","lvyou.smzdm.com":"旅游_","zhiyou.smzdm.com":"个人中心_","www.smzdm.com/fenlei/":"分类_","duihuan.smzdm.com":"福利_","new.brand.smzdm.com":"新品牌_"},o=t.pathname.split("/"),i="",a=t.hostname+(1===o.indexOf("p")?"/p/":1===o.indexOf("fenlei")?"/fenlei/":"");for(var n in e)if(a===n){i=e[n];break}return i||""},popup_login_init:function(t){var i=zhiyou_relate.gotChannelName(window.location),e=window.location.href;null!=t.redirect_url&&(e=t.redirect_url),zhiyou_relate.iframe_url="https://zhiyou.smzdm.com/user/login/window/#redirect_url="+encodeURIComponent(e);var o,a='<div class="pop" id="pop-login-new" style="display:none;margin-left:-240px;top:30%;"><i onclick=\''+(o="关闭按钮",""!==i?'dataLayer.push({"event":"'+i+o+'"})':"")+'\' class=\'pop-close icon-cross-lighter\'>\x3c!--[if lt IE 8]>x<![endif]--\x3e</i><div class="pop-title"></div><div class="pop-content"><iframe id="zhiyou_login_window_iframe" frameborder="0" style="width:315px;height:310px;" src="" scrolling="no"></iframe></div></div><div id="cover" style="display: none;"></div>',n="",r="";$("#pop-login-new").length<=0&&$("#footer").after(a),n=$("#pop-login-new"),r=$("#cover"),$(document).on("click",".zhiyou_login",function(){i&&"undefined"!=typeof dataLayer&&(dataLayer.push({event:i+"登录弹窗_出现次数"}),$("#cover").attr("onclick",'dataLayer.push({"event":"'+i+'半透明区域"})')),zhiyou_relate.popup_login_show()}),$(document).on("click",".J_login_trigger",function(t){t.preventDefault();var e=$(this);if(i&&"undefined"!=typeof dataLayer&&(dataLayer.push({event:i+"_登录弹窗_出现次数","频道名":i}),$("#cover").attr("onclick",'dataLayer.push({"event":"'+i+'_半透明区域","频道名":"'+i+'"})')),zhiyou_relate.popup_login_show(),"login"==e.data("style")){var o=document.getElementById("zhiyou_login_window_iframe");o.onload=function(){var t=JSON.stringify({type:2});o.contentWindow.postMessage(t,"*")}}}),$(document).on("click",".J_register_trigger",function(t){t.preventDefault();var e=$(this);if(i&&"undefined"!=typeof dataLayer&&(dataLayer.push({event:i+"_登录弹窗_出现次数","频道名":i}),$("#cover").attr("onclick",'dataLayer.push({"event":"'+i+'_半透明区域","频道名":"'+i+'"})')),zhiyou_relate.popup_login_show(),"register"==e.data("style")){var o=document.getElementById("zhiyou_login_window_iframe");o.onload=function(){var t=JSON.stringify({type:1});o.contentWindow.postMessage(t,"*")}}}),$("#pop-login-new").delegate(".pop-close","click",function(){n.hide(),r.hide(),zhiyou_relate.popup_login_refresh()}),$(document).on("click","#cover",function(){n.hide(),r.hide(),zhiyou_relate.popup_login_refresh()}),window.addEventListener?window.addEventListener("message",function(t){if("https://zhiyou.smzdm.com"===t.origin){var e=JSON.parse(t.data);if(1===e.agreeStatusType)zhiyou_relate.reset_login_iframe();else if(2===e.agreeStatusType){var o=document.getElementById("zhiyou_login_window_iframe");zhiyou_relate.reset_login_iframe(),o.onload=function(){var t=JSON.stringify({agreeType:"register_post"});o.contentWindow.postMessage(t,"*")}}}},!1):window.attachEvent&&window.attachEvent("onmessage",function(t){if("https://zhiyou.smzdm.com"===t.origin){var e=JSON.parse(t.data);if(1===e.agreeStatusType)zhiyou_relate.reset_login_iframe();else if(2===e.agreeStatusType){var o=document.getElementById("zhiyou_login_window_iframe");zhiyou_relate.reset_login_iframe(),o.onload=function(){var t=JSON.stringify({agreeType:"register_post"});o.contentWindow.postMessage(t,"*")}}}})},reset_login_iframe:function(){$("#cover").remove(),$("#cover").remove(),$("body").append("<div class='J_cover_pop'></div>"),$(".J_cover_pop").css({position:"fixed","z-index":"9999",top:"0",left:"0",width:"100%",height:"100%",background:"#000",filter:"alpha(opacity=50)",opacity:"0.5"}),$("#pop-login-new .pop-close").hide(),$("#pop-login-new .pop-title").hide(),$("#pop-login-new .pop-content").css({padding:"0",width:"495px",height:"413px"}),$("#zhiyou_login_window_iframe").css({width:"495px",height:"413px"})},popup_login_refresh:function(){var t=$("#zhiyou_login_window_iframe"),e=t.attr("src");""!==e&&(e=""),t.attr("src",""),setTimeout(function(){t.attr("src",e)},0)},popup_login_show:function(){var t=$("#zhiyou_login_window_iframe"),e=t.attr("src");return this.getClient()?window.webkit.messageHandlers.call_client_login.postMessage(null):"function"==typeof call_client_login?call_client_login():$(window).width()<=480?window.location=zhiyou_relate.iframe_url:(""===e&&t.attr("src",zhiyou_relate.iframe_url),$("#pop-login-new").show(),$("#cover").show()),!1},request_zhiyou_info:function(o){var i=this,t=i.baseUrl;"https:"===window.location.protocol&&(t=t.replace(/http/g,"https"));var e=t+"user/info/jsonp_get_current";$.ajax({type:"get",url:e,data:"",dataType:"jsonp",jsonp:"callback",success:function(t){if(0===t.is_agree_protocol){if(!/smzdmapp/i.test(navigator.userAgent)&&isPC()){$(".J_login_trigger").click();var e=document.getElementById("zhiyou_login_window_iframe");e.onload=function(){var t=JSON.stringify({agreeType:"reload_post"});zhiyou_relate.reset_login_iframe(),e.contentWindow.postMessage(t,"*")}}}else(zhiyou_relate.user_info=t).smzdm_id=parseInt(t.smzdm_id),0!=t.smzdm_id&&0!=t.bgm.length?setCookie("HAVE_BGM",1,"","/",".smzdm.com"):deleteCookie("HAVE_BGM"),i.user_info_default_callback(t),"function"==typeof o&&t.smzdm_id&&o(t),i.extra_user_info_callback(t),user_foucs_callback(t)},error:function(){}})},user_info:{},bgm:{},user_info_default_callback:function(t){var e=zhiyou_relate.gotChannelName(window.location),o=$(".J_user_entry .sub-nav li"),i=$(".submit-entry");if(t.is_business&&i.length&&(i.hide(),o.each(function(t,e){$(this).hide()}),o.first().show(),o.last().show()),t.smzdm_id){if(t.is_show_video){if("我的视频"!=$("#global-nav ul.control-list li.user-entry ul.sub-nav").find("li").eq(5).find("a").html()){var a=document.createElement("li");a.innerHTML='<a href="http://zhiyou.smzdm.com/user/v/" target="_blank" onclick="dataLayer.push('+"{'event': '通用_个人中心导航', '按钮名称': '我的视频'})\">我的视频</a>",$("#global-nav ul.control-list li.user-entry ul.sub-nav").find("li").eq(4).after(a)}for(var n=!1,r=0;r<$(".submit-entry .sub-nav").find("li").size();r++)"视频投稿"==$(".submit-entry .sub-nav").find("li").eq(r).find("a").html()&&(n=!0);if(!n){var s=document.createElement("li");s.innerHTML='<a href="http://v.smzdm.com/baoliao/" target="_blank">视频投稿</a>',$(".submit-entry .sub-nav").append(s)}}e&&"undefined"!=typeof dataLayer?dataLayer.push({event:e+"登录成功_次数"}):(console.log("href:",window.location.href),console.log("若href存在于字典，则dataLayer还未定义")),t.bgm&&!$.isEmptyObject(t.bgm)&&(zhiyou_relate.bgm=t.bgm);t.smzdm_id;var l=t.nickname,c=t.unread,d=t.logo,m=t.capabilities,p=t.avatar.split("small"),u=void 0!==p[0]?p[0]:"";void 0!==p[1]&&(u+="middle"+p[1]);var h=zhiyou_relate.baseUrl+"user",_=t.point,f=t.gold,g=t.checkin,v=t.comment_sync_sina;if($("body").append('<input id="log_status" type="hidden" value="1" />'),""!=m&&(m.administrator||m.editor||m.pinglun||m.edit_posts||m.moderate_comments)&&($("body").append('<input type="hidden" id="authority" value="editor" />'),$("#authority").val("all")),$(".J_login_trigger").parent().hide(),$(".J_user_entry").show(),$(".J_nav_username").html(t.nickname),0<$("#user_info").length){$("#user_info").attr("class","userInfo user_signIn"),$("#sign_login").hide(),$("#user_info_avatar").attr({src:u,alt:l}).unwrap("span").wrap('<a href=" '+h+' " class="userPic" target="_blank"></a>'),$("#user_info_name").html('<a href=" '+h+' " title=" '+l+' " target="_blank">'+l+"</a>"+d.medal+d.zhongce_grade+d.goldbl+" "+d.rank),0<$("#user_info_score").find("em").length?$("#user_info_score").find("em").html(_).end().next("a").andSelf().show():$("#user_info_score").html("积分:<em>"+_+"</em>"),0<$("#user_info_gold").find("em").length?$("#user_info_gold").find("em").html(f).end().next("a").andSelf().show():$("#user_info_gold").html("金币:<em>"+f+"</em>");var y=parseInt($("#user_info").attr("needMobileTips"));if($("#user_info_tosign").unbind("click").bind("click",zhiyou_relate.set_checkin),g.has_checkin&&($("#user_info_tosign").html("已签到"+g.daily_checkin_num+"天").removeClass("signScore").addClass("signScored").removeClass("zhiyou_login").unbind("click"),1!=y&&$("#user_info_tosign").attr("href","http://www.smzdm.com/qiandao/")),$("#user_info_tosign").removeClass("zhiyou_login"),"index"!=$("#channel").val()){var b=g.slogan;$(".scoreBox").after(b)}}if($("#comment_avatar").attr({src:u,alt:l}).unwrap("span").wrap('<a href=" '+h+' " class="userPic" target="_blank" title=" '+l+' "></a>'),$("#comment_avatar").parent(".userPic").after(' <a href=" '+h+' " class="comment_nickName a_underline" target="_blank"  title=" '+l+' ">'+l+"</a> "),$(".comment_switch").show(function(){v&&0<$("#commentform").find(".check").length?$("#comments .comment_share i.check").addClass("icon-rightframe"):v&&0<$("#commentform").find(".check").length&&$("#comments .comment_share i.check").removeClass("icon-rightframe")}),"0"!=c.notice.num||"0"!=c.pm.num||"0"!=c.comment.num){var w=parseInt(c.notice.num)+parseInt(c.pm.num);if(0!=w){var k=c.notice.url;parseInt(c.notice.num)<=0&&(k=c.pm.url),$(".J_notice_message").attr("href",k).find("em").html(w),99<w&&(w="99+"),$(".J_menu_message").attr("href",k).css("position","relative").html('我的消息<span style="position: absolute;background: #f04848;width: 6px;height: 6px;top: 3px;right: 8px;border-radius: 50%;"></span>')}else $(".J_notice_message").hide();if(0!=c.comment.num){var x=c.comment.url;$(".J_notice_comment").attr("href",x).find("em").html(c.comment.num),99<c.comment.num&&(c.comment.num="99+"),$(".J_menu_comment").attr("href",x).css("position","relative").html('我的评论<span style="position: absolute;background: #f04848;width: 6px;height: 6px;top: 3px;right: 8px;border-radius: 50%;"></span>')}else $(".J_notice_comment").hide();$(".J_notice").show().find(".z-icon-cross,.icon-cross-lighter").click(function(){$(".J_notice").hide()}),$(".J_notice").slideDown("slow")}else $(".J_notice").hide();var C=t.has_guanzhu_dongtai;99<(C=+C)&&(C="99+");var z='<div id="focus-notice" class="J_focus_notice"><i class="icon-cross-lighter" onclick=dataLayer.push({"event":"通用_关注浮层_关闭"})></i><a href="javascript:void(0)" target="_self">您有<span>'+C+"</span>条关注动态</a></div>";0!==t.has_guanzhu_dongtai&&void 0!==t.has_guanzhu_dongtai&&($(".J_notice").css("top","75px"),$(".nav-controls").append(z),$(".J_focus_notice").show(),$(document).on("click",".J_focus_notice .icon-cross-lighter",function(){$(".J_focus_notice").hide(),$(".J_notice").css("top","34px")}),$("#focus-notice a").unbind().click(function(t){t.stopPropagation(),dataLayer.push({event:"通用_关注浮层"}),window.location.href="//www.smzdm.com#follow",$(".column-tab-name")[0]&&$(".column-tab-name").find("li").eq(1).trigger("click")})),$("#comment_tips").remove(),$("#textareaComment").removeClass("zhiyou_login"),$(".noLogin").removeClass("noLogin");var j=$("#textareaComment").attr("default_data");$("#textareaComment").unbind("click").val(j).focus(function(){$(this).val()==j&&$(this).val(""),$(this).css("color","#666")}).blur(function(){""==$(this).val()&&$(this).val(j).css("color","#ccc")}).change(function(){$("#textCommentSubmit").removeAttr("disabled")}),$("#textCommentSubmit").removeAttr("disabled").removeClass("btn_subGrey").addClass("btn_sub");var A=t.banright;if(0<A.length){r=0;for(var I=A.length;r<I;r++)if(1==A[r]){var T=t.bantips;$("#textareaComment").html("").attr("disabled","disabled"),$("#comment_error").html(T).show(),$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled"),$(".comment_switch").hide(),$(".atta,.reply").unbind("click");break}}if(showHidenNotice(".login_Info","#chief_notice"),showHidenNotice(".submission","#chief_notice"),3<=parseInt(t.login_error_num)){var S=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",S),$(".captcha_switch").show()}if(t.close_comment_enter&&($("#textareaComment").html("").attr("disabled","disabled"),$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled"),$(".comment_switch").hide(),$(".atta,.reply").unbind("click")),t.is_use_captcha){S=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",S),$(".captcha_switch").show()}t.bgm&&t.bgm.permission&&t.bgm.permission.commentpermission&&(init_action(),$("#comment").append('<input type="hidden" readonly="readonly" id="is_bgm" name="is_bgm" value="1" />'))}else zhiyou_relate.footer_login_layer_init()},set_checkin:function(){$("#user_info_tosign").unbind("click"),$.ajax({type:"get",url:zhiyou_relate.baseUrl+"user/checkin/jsonp_checkin",dataType:"jsonp",jsonp:"callback",success:function(t){var e=t.error_code,o=t.error_msg;t.data;0==e?window.location.href="http://www.smzdm.com/qiandao/":popUp("","#pop-status",o.public)},error:function(){$("#user_info_tosign").bind("click",zhiyou_relate.set_checkin)}})},add_favorite:function(o,i,t){var a=this,e=$(t);console.log("$this->"+t),"https:"===window.location.protocol&&(a.baseUrl=a.baseUrl.replace(/http/g,"https"));var n,r,s,l,c=a.baseUrl+"user/favorites/";n=e.data("cid")?e.data("cid"):e.parents("li").data("cid")?e.parents("li").data("cid"):e.parents(".list").data("cid")?e.parents(".list").data("cid"):"无",r=e.data("atp")?e.data("atp"):e.parents("li").data("atp")?e.parents("li").data("atp"):e.parents(".list").data("atp")?e.parents(".list").data("atp"):"无",s=e.data("tagid")?e.data("tagid"):e.parents("li").data("tagid")?e.parents("li").data("tagid"):e.parents(".list").data("tagid")?e.parents(".list").data("tagid"):"无",l=e.data("position")?e.data("position"):e.parents("li").data("position")?e.parents("li").data("position"):e.parents(".list").data("position")?e.parents(".list").data("position"):"无";var d={client_type:getClientType(),event_key:"收藏",otype:e.hasClass("active")||e.hasClass("current")?"取消收藏":"收藏",aid:o,cid:n,p:l,source:"无",atp:r,tagID:s,sourcePage:document.referrer?document.referrer:"无",sourceMode:"无"};$.ajax({type:"get",url:c+"jsonp_favorite",data:{article_id:o,channel_id:i,client_type:d.client_type,event_key:d.event_key,otype:d.otype,aid:d.aid,cid:d.cid,p:d.p,source:d.source,atp:d.atp,tagID:d.tagID,sourcePage:d.sourcePage,sourceMode:d.sourceMode},dataType:"jsonp",jsonp:"callback",success:function(t){var e={3:"youhui",6:"news",11:"yuanchuang",7:"zhongce",8:"pingce",16:"2",31:"newbrand_topic"};0==t.error_code?($("#pop-collect .pop_info_show a:first").attr("href",c+e[i]),popPosition("#pop-collect"),$("#pop-collect").show(),$("#cover").show(),popClose("#pop-collect"),$("a[id='collect_"+i+"_"+o+"']").each(function(){$(this).attr("class","fav current");var t=Number($(this).find("em").html())+1;t<0&&(t=0),$(this).find("em").html(t)}),popUp("","#pop-collect","")):2==t.error_code?($("#pop-nocollect .pop_info_show a:first").attr("href",c+e[i]),popPosition("#pop-nocollect"),$("#pop-nocollect").show(),$("#cover").show(),popClose("#pop-nocollect"),$("a[id='collect_"+i+"_"+o+"']").each(function(){$(this).attr("class","fav");var t=Number($(this).find("em").html())-1;t<0&&(t=0),$(this).find("em").html(t)}),popUp("","#pop-nocollect","")):5==t.error_code?a.popup_login_show():t.error_code},error:function(){}})},init_favorite_by_cookie:function(){$(".fav").each(function(){var t=new Array([3,"youhui"],[6,"news"],[8,"test"],[7,"test_probation"],[11,"yuanchuang"],[16,"second"],[31,"newbrand_topic"]),e=$(this).attr("id");if(void 0!==e){var o=e.split("_"),a=o[2],n=o[1];for(i=0;i<t.length;i++){var r=getCookie("smzdm_collection_"+t[i][1]),s=[];if(r)s=r.split(",");n==t[i][0]&&-1<$.inArray(a,s)&&$(this).attr("class","fav current")}}})},scored:function(t,e){var o=$(t);o.find("a").hasClass(e)&&(o.mouseover(function(){$(this).find("."+e).css("display","none"),$(this).find(".scoredInfo").css("display","block")}),o.mouseout(function(){$(this).find("."+e).css("display","block"),$(this).find(".scoredInfo").css("display","none")}))},zhi_list_callback:function(t,e,o,i,a){if(1==i){var n=$("#rating_worthy_"+e);if(n.find(" .scoreAnimate").fadeIn().animate({top:"-30px"},"normal").fadeOut(300),n.find("em").length)var r=parseInt($.trim(n.find("em").html()));else{var s=n.find(" .scoreTotal").text().split(" ");r=parseInt(s[1])}r=r+1;n.find(" .scoreTotal").length?n.find(" .scoreTotal").html("<b>值</b> "+r):n.find("em").html(r)}else{var l=$("#rating_unworthy_"+e);if(l.find(" .scoreAnimate").fadeIn().animate({top:"30px"},"normal").fadeOut(300),0<l.find(" .scoreTotal em").length)r=parseInt($.trim(l.find(" .scoreTotal em").html()));else s=l.find(" .scoreTotal").text().split(" "),r=parseInt(s[1]);r=r+1;l.find(" .scoreTotal").html("<b>不值</b> "+r)}},zhi_detail_callback:function(t,e,o,i,a){var n,r=$("#rating_"+e),s=parseInt($.trim($("#rating_worthy_num").text())),l=parseInt($.trim($("#rating_unworthy_num").text()));n=1==i?($(r).find(".add").show().animate({top:"-30px"},600).fadeOut("slow",function(){$("#rating_worthy_num").html(s+1),$("#rating_all_num").html("已有 "+(s+l+1)+" 用户参与")}),(s+1)/(s+l+1)*100):($(r).find(".reduce").show().animate({top:"80px"},600).fadeOut("slow",function(){$("#rating_unworthy_num").html(l+1),$("#rating_all_num").html("已有 "+(s+l+1)+" 用户参与")}),s/(s+l+1)*100),r.find(" .progressing").css("width",n.toString()+"%")},zan_callback:function(t,e,o,i,a){$(a).find("span.addNumber").fadeIn().animate({top:"-35px"},"normal").fadeOut(300),$(a).attr("class","zan current"),zhiyou_relate.scored("#details-zan","current"),0<$(a).find("em").length?$(a).find("span.scoreAnimate").fadeIn().animate({top:"-35px"},"normal").fadeOut(300,function(){$(a).find("em").html(Number($(a).find("em").html())+1)}):0<$(a).parents(".show_exp_zan").find("em").length?$(a).parents(".show_exp_zan").find("em").html(Number($(a).parents(".show_exp_zan").find("em").html())+1):$(a).parents(".show_exp_zan").find(".grey").html("已有<em>1</em>人赞过")},add_rating:function(t,e,o,i,a){var n,r,s=this;if("zan"==t){var l=s.zan_callback;$(a).removeAttr("onclick"),$(a).css("cursor","default"),r=$(a),n="点赞"}else if("zhi_list"==t){l=s.zhi_list_callback;var c=$("#rating_worthy_"+e),d=$("#rating_unworthy_"+e);c.removeAttr("onclick").css("cursor","default"),d.removeAttr("onclick").css("cursor","default"),n=1==i?(c.addClass("current").addClass("worthCurrent"),d.addClass("unworthCurrent"),r=$("#rating_worthy_"+e),"点值"):(c.addClass("worthCurrent"),d.addClass("current").addClass("unworthCurrent"),r=$("#rating_unworthy_"+e),"点不值")}else if("zhi_in"==t){l=s.zhi_detail_callback,$("#rating_"+e),c=$("#rating_worthy"),d=$("#rating_unworthy");n=1==i?"点值":"点不值",r=1==i?$("#rating_worthy"):$("#rating_unworthy"),c.removeAttr("onclick").css("cursor","default").addClass("worthCurrent"),d.removeAttr("onclick").css("cursor","default").addClass("unworthCurrent"),zhiyou_relate.scored("#details-zhi","worthCurrent"),zhiyou_relate.scored("#details-buzhi","unworthCurrent")}"https:"===window.location.protocol&&(s.baseUrl=s.baseUrl.replace(/http/g,"https")),$.ajax({type:"get",url:s.baseUrl+"user/rating/jsonp_add",data:{article_id:e,channel_id:o,rating:i,client_type:/smzdm/i.test(navigator.userAgent)?/android/i.test(navigator.userAgent)?"android":"iphone":isPC()?"PC":"WAP",event_key:"点值",otype:n,aid:e,p:r.attr("data-position")||r.parents("div.list").attr("data-position")||r.parents("li").attr("data-position")||"无",cid:r.attr("data-cid")||r.parents("div.list").attr("data-cid")||r.parents("li").attr("data-cid")||"无",source:"无",atp:r.attr("data-atp")||r.parents("div.list").attr("data-atp")||r.parents("li").attr("data-atp")||"无",tagID:r.attr("data-tagID")||r.parents("div.list").attr("data-tagID")||r.parents("li").attr("data-tagID")||"无",sourcePage:document.referrer||"无",sourceMode:"无"},dataType:"jsonp",jsonp:"callback",success:function(t){l(t,e,o,i,a)},error:function(){}})},init_rating_by_cookie:function(){for(var t=[0,3,6,7,8,9,10,11,16],e=1,o=t.length;e<o;e++){var a=t[e],i=getCookie("smzdm_rating_"+a);i&&(rating_cookie=json_decode(i),3==a?($(".lrBot").length&&$(".lrBot").each(function(){if(void 0!==$(this).find(" .good").attr("id")){var t=$(this).find(" .good").attr("id").split("_")[2];if(t in rating_cookie){var e=$("#rating_worthy_"+t);if(0<e.length){var o=$("#rating_unworthy_"+t);e.removeAttr("onclick"),o.removeAttr("onclick"),1==rating_cookie[t]?(e.addClass("current").css("cursor","default").addClass("worthCurrent"),o.css("cursor","default").addClass("unworthCurrent")):-1==rating_cookie[t]&&(e.css("cursor","default").addClass("worthCurrent"),o.addClass("current").css("cursor","default").addClass("unworthCurrent"))}}}}),$(".zan_fav_com").length&&$(".zan_fav_com").each(function(){if(void 0!==$(this).find(" .zan").attr("id")){var t=$(this).find(" .zan").attr("id").split("_")[2];if(t in rating_cookie){var e=$("#rating_worthy_"+t);0<e.length&&(e.removeAttr("onclick"),1==rating_cookie[t]&&e.addClass("current").css("cursor","default"))}}}),$(".score_rateBox").each(function(){if(void 0!==$(this).attr("id")&&$(this).attr("id").split("_")[1]in rating_cookie){var t=$("#rating_worthy");if(0<t.length){var e=$("#rating_unworthy");t.removeAttr("onclick").css("cursor","default"),e.removeAttr("onclick").css("cursor","default"),t.addClass("worthCurrent"),e.addClass("unworthCurrent"),scored("#details-zhi","worthCurrent"),scored("#details-buzhi","unworthCurrent")}}})):$(".zan").each(function(){var t=$(this).attr("id");if(void 0!==t){var e=t.split("_"),o=e[3],i=e[2];a==i&&o in rating_cookie&&($(this).attr("class","zan current"),$(this).removeAttr("onclick"),$(this).css("cursor","default"))}}))}},setCookie:function(t,e,o,i,a,n){o=o||604800,o*=1e3;var r=new Date;r.setTime(r.getTime()+o),document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+(r?"; expires="+r.toGMTString():"")+(i?"; path="+i:"/")+(a?"; domain="+a:"")+(n?"; secure":"")},footer_login_layer_init:function(){var t=".footer_login_layer",o=$(t).data("login_layer_show_gtm"),e=$(t).data("click_login_gtm"),i=$(t).data("click_register_gtm"),a=$(t).data("click_close_gtm"),n="#footer_layer",r="has_show_login_layer",s='<div class="footer-layer" id="footer_layer" style="display:none"><div class="layer-center"><div class="layer-left"><ul><li><img src="http://res.smzdm.com/images/zhiyou/material/footer_login_layer.png"/></li><li><button class="Login zhiyou_login" onclick="dataLayer.push({\'event\':\''+e+"'})\">登录</button></li><li><button class=\"register\" onclick=\"window.open('http://zhiyou.smzdm.com/user/register/mobile','_blank');dataLayer.push({'event':'"+i+'\'})" >注册</button></li></ul></div><div class="layer-right" id="del_layer"><i class="icon-cross-lighter close_footer_layer" onclick="dataLayer.push({\'event\':\''+a+"'})\"></i></div></div></div>",l=getCookie(r),c=window.location.hash,d=window.location.hostname,m=window.location.pathname,p="详情页";switch(d){case"news.smzdm.com":p="资讯详情";break;case"post.smzdm.com":p="原创详情";break;case"wiki.smzdm.com":p="百科详情";break;case"2.smzdm.com":p="二手详情";break;case"www.smzdm.com":p=0==m.indexOf("/zhuanti/")?"专题详情":"优惠详情";break;case"test.smzdm.com":p=0==m.indexOf("/pingce/p")?"评测详情":"众测详情"}var u="dataLayer.push({'event':'"+p+"_评论_浮层登录'});",h="dataLayer.push({'event':'"+p+"_评论_浮层注册'});",_="dataLayer.push({'event':'"+p+"_评论_浮层关闭'});",f=$("#footer_nologin_comment_layer").data("title");f&&void 0!==f&&(u="ga('send', 'event', '专题活动', '"+f+"_评论浮层', '登录');",h="ga('send', 'event', '专题活动', '"+f+"_评论浮层', '注册');",_="ga('send', 'event', '专题活动', '"+f+"_评论浮层', '关闭');");var g='<div class="footer-layer" id="footer_layer" style="display:none"><div class="layer-center"><div class="layer-left"><ul><li><img src="//res.smzdm.com/images/zhiyou/material/footer_comment_login_layer.png"/></li><li><button class="Login zhiyou_login" onclick="'+u+"\">登录</button></li><li><button class=\"register\" onclick=\"window.open('http://zhiyou.smzdm.com/user/register/mobile','_blank');"+h+'" >注册</button></li></ul></div><div class="layer-right" id="del_layer"><i class="icon-cross-lighter close_footer_layer" onclick="'+_+'"></i></div></div></div>';if("1"==l)return!1;function v(t,e){void 0!==$(n)&&$(n)&&0<=$(n).length&&$(n).remove(),$("#footer").after(t),1==e&&"undefined"!=typeof dataLayer&&dataLayer.push({event:"virtualPageview",page:o}),2==e&&"undefined"!=typeof ga&&(f&&void 0!==f?ga("send","event","专题活动",f+"_评论浮层","展现"):ga("send","event","专题活动","专题活动_评论浮层","展现")),$(n).show(),$(".close_footer_layer").click(function(){$(this);$(n).hide(),zhiyou_relate.setCookie(r,"1",604800,"/",".smzdm.com")})}$(t).length<=0?0==c.indexOf("#comments")&&v(g,2):v(s,1)}};zhiyou_relate.init(),zhiyou_relate.extra_user_info_callback=function(t){};var smzdm_domain=".smzdm.com",comment_report_cookiename="comment_report";window.comment_report_cookie_list;var comment_rating_cookiename="comment_rating";window.comment_rating_cookie_list;var StringBuilder=function(t){this.s=new Array(t),this.onMultiAppendBeforeHandle=null,this.onMultiAppendBefore=function(t){return this.onMultiAppendBeforeHandle=t,this},this.append=function(t){return this.s.push(t),this},this.toString=function(){return this.s.join("")},this.clear=function(){this.s=new Array},this.appendMultiFormat=function(t,e){if("object"==typeof e)for(var o in e)null!=this.onMultiAppendBeforeHandle&&this.onMultiAppendBeforeHandle(e[o]),this.appendFormat(t,e[o]);return this},this.appendFormat=function(){var t=arguments.length;if(0==t)return this;var e=arguments[0];if(1==t)return this.append(e);var o,i,a,n,r,s=arguments[1];for(null==s&&(s=""),r="object"==typeof s?function(t,e){return t[1][e]}:function(t,e){return t[e-0+1]},o=0;o<e.length;)"{"!=(a=e.charAt(o))?(this.s.push(a),o++):(i=e.indexOf("}",o),n=e.substring(o+1,i),this.s.push(r(arguments,n)),o=i+1);return this}};function popPosition(t){var e=$(window).width(),o=$(window).height(),i=$(t).width(),a=$(t).height();$(t).css({left:e/2-i/2,top:o/2-a/2})}function json_encode(t){var e=this.window.JSON;if("object"==typeof e&&"function"==typeof e.stringify)return e.stringify(t);var d=function(t){var e=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return e.lastIndex=0,e.test(t)?'"'+t.replace(e,function(t){var e=o[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'},m=function(t,e){var o="",i=0,a="",n="",r=0,s=o,l=[],c=e[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),typeof c){case"string":return d(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(o+="    ",l=[],"[object Array]"===Object.prototype.toString.apply(c)){for(r=c.length,i=0;i<r;i+=1)l[i]=m(i,c)||"null";return n=0===l.length?"[]":o?"[\n"+o+l.join(",\n"+o)+"\n"+s+"]":"["+l.join(",")+"]",o=s,n}for(a in c)Object.hasOwnProperty.call(c,a)&&(n=m(a,c))&&l.push(d(a)+(o?": ":":")+n);return n=0===l.length?"{}":o?"{\n"+o+l.join(",\n"+o)+"\n"+s+"}":"{"+l.join(",")+"}",o=s,n}};return m("",{"":t})}function json_decode(str_json){var json=this.window.JSON;if("object"==typeof json&&"function"==typeof json.parse)return json.parse(str_json);var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,text=str_json;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),j;throw new SyntaxError("json_decode")}function getCookie(t){var e=document.cookie.indexOf(t),o=document.cookie.indexOf(";",e),i=document.cookie.substring(e+t.length+1,e<o?o:document.cookie.length);return-1==e?"":decodeURIComponent(i)}function setCookie(t,e,o,i,a,n){o=o||604800,o*=1e3;var r=new Date;r.setTime(r.getTime()+o),document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+(r?"; expires="+r.toGMTString():"")+(i?"; path="+i:"/")+(a?"; domain="+a:"")+(n?"; secure":"")}function setCookieArr1(t,e,o,i,a,n){var r=getCookie(t);if(r&&(m=json_decode(r)),m){var s=m.length;if(s>=cookie_length_limit){var l=new Array;for(var c in m[cookie_length_limit]=e,m)if(c<=s-1){var d=parseInt(c)+1;l[c]=m[d.toString()]}m=l}else m[s]=e}else{var m;(m=new Array)[0]=e}setCookie(t,json_encode(m),o=o||604800,i,a,n)}function getBooInCookieArr1(t,e){var o=getCookie(t);if(o){var i=json_decode(o);if(i)for(var a in i)if(i[a]&&i[a]==e)return!0}return!1}function setCookieArr2(t,e,o,i,a,n,r){var s=getCookie(t);if(s&&(p=json_decode(s)),p){var l=p.length;if(l>=cookie_length_limit){var c=new Array;for(var d in p[cookie_length_limit]=new Array,p[cookie_length_limit][0]=e,p[cookie_length_limit][1]=o,p)if(d<=l-1){var m=parseInt(d)+1;c[d]=p[m.toString()]}p=c}else p[l]=new Array,p[l][0]=e,p[l][1]=o}else{var p;(p=new Array)[0]=new Array,p[0][0]=e,p[0][1]=o}setCookie(t,json_encode(p),i=i||604800,a,n,r)}function getBooInCookieArr2(t,e){var o=getCookie(t);if(o){var i=json_decode(o);if(i)for(var a in i)if(i[a]&&i[a][0]&&i[a][0]==e)return!0}return!1}function deleteCookie(t){var e=getCookie(t);setCookie(t,e,-1*(new Date).getTime()/1e3,"/"),setCookie(t,e,-1*(new Date).getTime()/1e3,"/",HIS_DOMAIN)}function deleteCookieInArr(t,e){var o=getCookie(t);if(""!==o){var i=o.split(",");-1!==$.inArray(""+e,i)&&(i.splice($.inArray(""+e,i),1),setCookie(t,i.join(","),-1*(new Date).getTime()/1e3,"/"),setCookie(t,i.join(","),null,"/",HIS_DOMAIN))}}function setCookieInArr(t,e,o,i,a,n){var r=getCookie(t);if(""!==r){var s=r.split(",");-1==$.inArray(""+e,s)&&(s.push(e),setCookie(t,s.join(","),o,i,a,n))}else setCookie(t,e,o,i,a,n)}function isPC(){for(var t=navigator.userAgent,e=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),o=!0,i=0;i<e.length;i++)if(0<t.indexOf(e[i])){o=!1;break}return o}function getClientType(){var t=navigator.userAgent;return/smzdmapp/i.test(t)?/(Android)/i.test(t)?"android":"iphone":/(Android)|i(Phone|Pad|Pod|OS)/i.test(t)?"WAP":"PC"}function showCommentBind(t,e,o){zhiyou_relate.popup_login_show(),$("#zhiyou_login_window_iframe").attr("src","https://zhiyou.smzdm.com/user/mobile/window/");$("#pop-login-new .pop-close").addClass("J_comment_pop").off("click");19===t&&$(document).on("click",".J_comment_pop, #cover",function(){$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_set_comment?submit_num=2",data:e,dataType:"jsonp",jsonp:"callback",success:function(t){window.location.reload()},error:function(t){console.log(t)}})}),window.addEventListener?window.addEventListener("message",function(t){"https://zhiyou.smzdm.com"===t.origin&&(1===JSON.parse(t.data).conType&&($(".J_comment_pop").click(),o?$("#textCommentSubmitQuick").removeAttr("disabled").click():$("#textCommentSubmit").removeAttr("disabled").click()))},!1):window.attachEvent&&window.attachEvent("onmessage",function(t){"https://zhiyou.smzdm.com"===t.origin&&(1===JSON.parse(t.data).conType&&($(".J_comment_pop").click(),o?$("#textCommentSubmitQuick").removeAttr("disabled").click():$("#textCommentSubmit").removeAttr("disabled").click()))})}function limitKeyup(t){1e3<=$(t).val().length&&$(t).val($(t).val().substring(0,1e3))}function showHide(t,e,o){$(document).on("mouseover",t,function(){$(this).addClass(e),$(this).find(o).show()}),$(document).on("mouseout",t,function(){$(t).removeClass(e),$(t).find(o).hide()})}function openClose(t,e,o){if("mallNav"==o)$(t).click(function(){$(this).prev().css("height","auto"),$(this).hide(),$(this).next("a").show()}),$(e).click(function(){$(this).parent().find("ul").css("height","64px"),$(this).hide(),$(this).prev("a").show()});else if("comments"==o){for(var i=$("blockquote").length,a=0;a<i;a++){$(t).prev(".comment_con").eq(a).height();120==$(t).prev(".comment_con").eq(a).height()?$(t).eq(a).css("display","block"):$(t).eq(a).css("display","none")}$(t).click(function(){$(this).prev().css({height:"auto","max-height":"100%"}),$(this).hide(),$(this).next("a").show()})}}function init_action(){0<$("#comments .tab_info .comment_listBox").length&&$(".comment_listBox li.comment_list, .comment_listBox li.comment_list blockquote").each(function(){var t=$(this).attr("blockquote_cid"),e=$(this).find(".user_name:first").attr("usmzdmid");if($(this).hasClass("comment_list")){var o=$(this).attr("id").split("_");t=o[o.length-1]}var i='<a href="//users.bgm.smzdm.com/new/blackroom/add?user_id=&smzdm_id='+e+'" title="关小黑屋" target="_blank">关小黑屋</a>';0!=e&&null!=e||(i="");var a='<a href="javascript:void(0);" title="打码" onclick="mosaic_show_textarea('+t+')">打码</a>'+i+('<a href="javascript:void(0);" onclick="delete_comment_confirm('+t+')" title="删除">删除</a>')+('<a href="//comments.bgm.smzdm.com/comments/info/'+t+'" title="编辑" target="_blank">编辑</a>');$(this).find(".dingNum:last").before(a)})}function func_atta(t){t&&null!=typeof t||(t="#comment"),$(t+" .atta").click(function(){if(1!=parseInt($("#log_status").val()))zhiyou_relate.popup_login_show();else{$(window).scrollTop($("#comments").offset().top-50);var t=$("#textareaComment");if(0<t.length){var e=$(this).attr("title"),o=$.trim(t.val());if(o==$.trim($("#textareaComment").attr("default_data")))o=e+" ";else{var a=o.split(" "),n=!0;for(i=0;i<a.length;i++)if(e==a[i]){n=!1;break}n?o=e+" "+o+" ":o+=" "}return t.focus().val(o),!0}}return!0})}function func_report(obj_name){obj_name&&null!=typeof obj_name||(obj_name="#comment"),$(obj_name+" .jubao").each(function(){if($(this).attr("id")){var t=$(this).attr("id").split("_")[1];if(""==t||null==t||"0"==t)return!1;var e=getCookie(comment_report_cookiename);if(e){var o=json_decode(e);if(o)for(var i in o)o[i]&&o[i]==t&&has_report_omment(t)}}}).click(function(){if($(this).attr("id")){var report_cid=$(this).attr("id").split("_")[1];if(""==report_cid||null==report_cid||"0"==report_cid)return!1;var boo_in_cookie=getBooInCookieArr1(comment_report_cookiename,report_cid);if(boo_in_cookie)return setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain),popUp("","#pop-status-fail-twoLine","您已经举报过了，我们正在处理，多谢反馈！"),!1;var report_type=1,report_text="";popPosition("#pop-report");var $popReport=$("#pop_report_opinion"),$popSubmit=$("#pop_report_submit");return $popReport.find("textarea").val("").end().hide(),$popSubmit.removeAttr("disabled").removeClass().addClass("btn_login"),$("#pop-report").show(function(){$(this).find("input[type='radio']").removeAttr("checked").click(function(){var t=$(this).attr("id").split("_")[2];9==(report_type=t)?($popReport.find("textarea").val("").end().show(),$popSubmit.attr("disabled","disabled").removeClass("btn_login").addClass("btn_grey"),$popReport.find("textarea").bind("keyup mouseup",function(){var t=$(this).val().length;report_text=$popReport.find("textarea").val(),2<=t?$popSubmit.removeAttr("disabled").removeClass("btn_grey").addClass("btn_login"):$popSubmit.attr("disabled","disabled").removeClass("btn_login").addClass("btn_grey")})):(report_text="",$popReport.is(":visible")&&($popReport.hide(),$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")))})}),$("#cover").show(),popClose("#pop-report"),void $("#pop_report_submit").unbind("click").click(function(){$("#pop-report,#cover").hide(),$("#pop_report_opinion").hide(),$("#pop_report_opinion").find("textarea").val(""),$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_comment_report",data:"type="+report_type+"&content="+report_text+"&cid="+report_cid,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);0==result.error_code?(has_report_omment(report_cid),setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain),popUp("","#pop-status-success","举报成功！")):result.error_msg?popUp("","#pop-status-fail",result.error_msg):popUp("","#pop-status-fail","举报失败！")},error:function(){popUp("","#pop-status-fail","网络错误")}})})}})}function commentReport(commentid,obj){var span_aid=obj.attr("id");if(span_aid&&null!=span_aid&&null!=typeof span_aid){var report_cid=span_aid.split("_")[1];if(""==report_cid||null==report_cid||"0"==report_cid)return!1;var boo_in_cookie=getBooInCookieArr1(comment_report_cookiename,report_cid);if(boo_in_cookie)return setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain),popUp("","#pop-status-fail-twoLine","您已经举报过了，我们正在处理，多谢反馈！"),!1;var report_type=1,report_text="";return popPosition("#pop-report"),$("#pop-report").css({position:"fixed",top:"50%",left:"50%","margin-left":"-240px","margin-top":"-165px"}).show(function(){$("#pop_report_opinion").hide(),$(this).find("input[type='radio']").removeAttr("checked").click(function(){var t=$(this).attr("id").split("_")[2];9==(report_type=t)?($("#pop_report_opinion").show(),$("#pop_report_submit").attr("disabled","disabled").addClass("btn_grey"),$("#pop_report_opinion").find("textarea").show().bind("keyup mouseup",function(){var t=$(this).val().length;report_text=$("#pop_report_opinion").find("textarea").val(),10<=t?$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login"):$("#pop_report_submit").attr("disabled","disabled").addClass("btn_grey")})):(report_text="",$("#pop_report_opinion").is(":visible")&&($("#pop_report_opinion").hide().find("textarea").hide(),$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")))})}),$("#cover").show(),popClose("#pop-report"),$("#pop_report_submit").unbind("click").click(function(){return $("#pop-report,#cover").hide(),$("#pop_report_opinion").hide(),$("#pop_report_opinion").find("textarea").val(""),$(this).attr("disabled","disabled").addClass("btn_grey"),$(".pop_report_opinion p").html("最少输入10个字").attr("class","grey"),$.ajax({type:"POST",url:"/user/comment/ajax_report",data:"type="+report_type+"&content="+report_text+"&cid="+report_cid,dataType:"json",success:function(data){$(this).removeAttr("disabled").removeClass("btn_grey").addClass("btn_login");var result=eval(data);0==result.error_code?(has_report_omment(report_cid),$("#report_"+report_cid).removeAttr("onclick").html("已举报"),setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain),popUp("","#pop-status-success","举报成功！")):result.error_msg?popUp("","#pop-status-fail",result.error_msg):popUp("","#pop-status-fail","举报失败")},error:function(){popUp("","#pop-status-fail","网络错误")}}),$(this).removeAttr("disabled").removeClass("btn_grey").addClass("btn_login"),!1}),!1}}function has_report_omment(t){$("#comment .tab_info .comment_listBox li #report_"+t).removeAttr("onclick").addClass("comment-report").html("已举报")}function get_rating_num(t,e,o){var i="cdc_support_"+e;0==o&&(i="cdc_oppose_"+e);var a=$("#li_comment_"+t+" #"+i+":first span").html();a?a=(a=a.split("(")[1].split(")")[0])?parseInt(a):0:a=0;return a}function has_rating_omment(t,e,o,i){1==e?($("#comment .tab_info .comment_listBox li #cdc_support_"+t).removeAttr("onclick").addClass("current").html("顶<span>("+o+")</span>"),$("#comment .tab_info .comment_listBox li #cdc_oppose_"+t).removeAttr("onclick").removeClass("current")):($("#comment .tab_info .comment_listBox li #cdc_support_"+t).removeAttr("onclick").removeClass("current"),$("#comment .tab_info .comment_listBox li #cdc_oppose_"+t).removeAttr("onclick").addClass("current").html("踩<span>("+i+")</span>"))}function init_smile(){var t="";if("undefined"!=typeof smileJSON&&smileJSON.length){smileJSON.length;for(var e=0,o=smileJSON.length;e<o;e++)if(smileJSON.hasOwnProperty(e)&&smileJSON[e]){for(var i="",a=0,n=smileJSON[e].length;a<n;a++)smileJSON[e].hasOwnProperty(a)&&smileJSON[e][a]&&(i+='<li><a href="javascript:void(0)" class="'+smileJSON[e][a][0]+'" default-data="['+smileJSON[e][a][1]+']" title="'+smileJSON[e][a][1]+'"></a></li>');$('<ul class="smileBox" '+(e+1!==1?'style="display:none;"':"")+"></ul>").append(i).appendTo(".smileLayerBg"),t+='<a href="javascript:void(0)"'+(e+1===1?' class="current"':"")+">"+(e+1)+"</a>"}$('<div class="smilePage"></div>').append(t).appendTo(".smileLayerBg")}var r=$.trim($("#textareaComment").attr("default_data"));$(".icon-small").click(function(){if($(".smileLayerBg").hide(),"1"==$(this).attr("isclick"))$(this).removeAttr("isclick");else{$(".icon-small").each(function(){$(this).removeAttr("isclick")}),$(this).attr("isclick","1");var t=$(this).parent();t.find(".smileLayerBg").show(),t.find(".smileLayerBg .smileBox").hide().eq(0).show(),t.find(".smileLayerBg .smilePage a").removeAttr("class").eq(0).attr("class","current")}}),$(document).on("click",".smilePage a",function(){$(this).addClass("current").siblings().removeClass("current"),$(".smileBox").hide().eq($(".smilePage a").index(this)).show()}),$(document).on("click",".smileLayerBg li a",function(){var t=$(this).parents(".comment_smileBox"),e=t.parent().parent().find("textarea:first");t.find(".smileLayerBg").css("display","none"),t.find(".icon-small").removeAttr("isclick");var o=e.attr("default"),i=e.val();i==r&&(i="");var a=i;if(o)a=i.replace(o,"");e.val(a),e.insertContent($(this).attr("default-data"))})}function init_comment_rating(t){var i=getCookie(comment_rating_cookiename);i&&(t&&null!=typeof t||(t="#comment"),$(t+" .dingNum").each(function(){if($(this).attr("id")){var t=$(this).attr("id").split("_")[2];if(""==t||null==t||"0"==t)return!1;var e=json_decode(i);if(e)for(var o in e)e[o]&&e[o][0]&&e[o][0]==t&&("1"==e[o][1]?($("#comment .tab_info .comment_listBox li #cdc_support_"+t).removeAttr("onclick").removeClass("current").addClass("current"),$("#comment .tab_info .comment_listBox li #cdc_oppose_"+t).removeAttr("onclick").removeClass("current")):($("#comment .tab_info .comment_listBox li #cdc_support_"+t).removeAttr("onclick").removeClass("current"),$("#comment .tab_info .comment_listBox li #cdc_oppose_"+t).removeAttr("onclick").removeClass("current").addClass("current")))}}))}function comment_rating_ajax(type,rating,comment_id,pid,licid){var dingnum=get_rating_num(licid,comment_id,1),cainum=get_rating_num(licid,comment_id,0),boo_in_cookie=getBooInCookieArr2(comment_rating_cookiename,comment_id);if(boo_in_cookie)return has_rating_omment(comment_id,rating,dingnum,cainum),setCookieArr2(comment_rating_cookiename,comment_id,rating,604800,"/",smzdm_domain),alert("您已打分"),!1;$.ajax({type:"GET",url:zhiyou_relate.baseUrl+"user/comment/ajax_rating",data:"comment_id="+comment_id+"&rating="+rating,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);0==rating?cainum+=1:dingnum+=1,has_rating_omment(comment_id,rating,dingnum,cainum),0==result.error_code&&setCookieArr2(comment_rating_cookiename,comment_id,rating,604800,"/",smzdm_domain)}})}function show_confirm(){$("#pop-tips").css({left:"50%","margin-left":"-240px",top:"50%","margin-top":"-115px"}).show(),$("#cover").show(),$("#layerBtnL").removeAttr("onclick"),$("#cover").on("click",function(){close_submit_confirm()})}function del_comment_confirm(t){show_confirm(),$("#layerBtnL").bind("click",function(){close_submit_confirm(),del_comment(t,0)})}function del_comment(e,t){$.ajax({type:"POST",url:zhiyou_relate.baseUrl+"user/comment/ajax_del_comment",data:"comment_id="+e+"&operator="+t,dataType:"jsonp",jsonp:"callback",success:function(t){0==t.error_code?(null!=typeof $("#div_comment_"+e)&&$("#div_comment_"+e).remove(),popUp("","#pop-status-success","删除成功")):t.error_msg?popUp("","#pop-status-fail",t.error_msg):popUp("","#pop-status-fail","操作失败")},error:function(){popUp("","#pop-status-fail","网络错误")}})}function delete_comment_confirm(t){window.confirm("确定删除该评论？")&&commentDelete(t,1)}function commentDelete(e,t){$.ajax({type:"POST",url:zhiyou_relate.baseUrl+"user/comment/ajax_del_comment",data:"comment_id="+e+"&operator="+t,dataType:"jsonp",jsonp:"callback",success:function(t){0==t.error_code&&($(".comment_listBox").find("#li_comment_"+e).remove(),$(".comment_listBox").find("[blockquote_cid='"+e+"']").remove(),popUp("","#pop-status-success","删除成功"))}})}function clearReplyCss(){$("#quickComment").val(""),$(".textarea_quick").height("auto")}function commentQuickReply(t){$(t).click(function(){if(1!=parseInt($("#log_status").val()))zhiyou_relate.popup_login_show();else{clearReplyCss();var t=$("#quickReply"),e=0;$(this).attr("id")&&(""!=(e=$(this).attr("id").split("_")[2])&&null!=e&&"0"!=e&&0!=e||(e=0),t.find("#parentid").val(e));var o=$(this).parent().parent(".comment_conWrap").find(".blankDiv");""==$(o).html()?($(o).html(t),$("#quickReply").show(),$(this).parent(".comment_action").css({display:"block",visibility:"visible"})):$("#quickReplyDiv").html(t)}})}function visibleOrNot(t,e,o){$(t).hover(function(){"visibility"?$(this).children().find(e).css("visibility","visible"):"display"&&$(this).children().find(e).css("display","block")},function(){"visibility"?$(this).children().find(e).css("visibility","hidden"):"display"&&$(this).children().find(e).css("display","none")})}function popClose(t){$(t).find(".pop-close").click(function(){$(t).hide(),$("#cover").hide()}),$("#cover").click(function(){$(t).hide(),$("#cover").hide()})}function popUp(t,e,o,i){""!=t?$(t).click(function(){popPosition(e),$(e).show(),$("#cover").show(),popClose(e)}):(i?($(e).find(".pop_info").html(o),popPosition(e),$(e).show(),$("#cover").show()):($(e).find(".pop_info").html(o),popPosition(e),$(e).show(),$("#cover").show(),setTimeout(function(){$(e).hide(),$("#cover").hide()},2e3)),popClose(e))}function comment_share_to_sina(t){return $(t).click(function(){var e=0;if($(this).hasClass("icon-rightframe")){e=1;var t="no";$("#comments .comment_share i.check").removeClass("icon-rightframe")}else{e=0;t="yes";$("#comments .comment_share i.check").addClass("icon-rightframe")}$.ajax({type:"POST",url:"/ajax_set_weibo_connect",data:"isconnect="+t,dataType:"json",success:function(t){return 0!=t.error_code&&(popUp("","#pop-status-fail",t.error_msg),e?$("#comments .comment_share i.check").addClass("icon-rightframe"):$("#comments .comment_share i.check").removeClass("icon-rightframe")),!0}})}),!1}function on_check_comment_page(t,e,o){var i=$(o).parent().parent().find(".jumpToPage #input_num").val();return/^[1-9]+[0-9]*]*$/.test(i)?(i<=0&&(i=1),t<i&&(i=t),location.href=e+"#comments",1<=i&&(location.href=e+"p"+i+"#comments")):alert("请输入有效数字！"),!0}$.fn.autoTextarea=function(t){if($("#quickReply")){var e={maxHeight:null,minHeight:$(this).height()},a=$.extend({},e,t);$(this).bind("paste cut keydown keyup focus blur",function(){var t,e=this.style;this.style.height=a.minHeight+"px";var o=$(this).css("padding-top").split("",1),i=parseInt(o);this.scrollHeight>a.minHeight&&(a.maxHeight&&this.scrollHeight>a.maxHeight?(t=a.maxHeight-i,e.overflowY="scroll"):(t=this.scrollHeight-i,e.overflowY="hidden"),e.height=t-i+"px")})}},$(function(){showHide(".downloadApp","",".more-share-box"),document.onkeydown=function(t){var e=null;if(null!=(e=window.event?window.event:t)&&e.ctrlKey&&13==e.keyCode){var o=$("#quickComment").is(":focus"),i=$("#textareaComment").is(":focus"),a=$("#choujiangComment").is(":focus");1==i&&$("#textCommentSubmit").click(),1==o&&$("#textCommentSubmitQuick").click(),1==a&&$("#choujiangCommentSubmit").click()}},commentQuickReply(".reply"),visibleOrNot(".operate_box",".noGoods","visibility"),visibleOrNot("blockquote",".comment_action","display");try{tab&&"function"==typeof tab&&tab(".tab_comment_li",".tab_info","current_item","click")}catch(t){}openClose(".seaAll","","comments"),openClose("a.more","a.pickup","mallNav"),$("#textareaComment, .comment_tips").addClass("zhiyou_login"),comment_share_to_sina("i.check"),$(".textarea_quick").height("auto");var quickComment_obj=$("#quickComment");quickComment_obj.length&&(quickComment_obj.val(""),quickComment_obj.autoTextarea({maxHeight:200}));var ok_txt="评论成功，稍后在页面中显示。每日前三条评论还加经验哦！",txt3='"><i class="icon-loginright"></i> '+ok_txt,txt4='"><i class="icon-loginright"></i> '+ok_txt,txt5='"><i class="icon-loginright"></i> 为维护良好讨论环境，新注册用户的评论需人工审核后再显示，请谅解',txt8='"><i class="icon-loginright"></i> <span class="red">你的投票已超过次数限制或未达到投票权限，该评论仅作为普通评论</span>',txt10='评论同步新浪微博失败，您尚未绑定微博账号，<span class="red" id="goback">4</span>秒后将带您进入微博授权页',$submit=$("#commentform #textCommentSubmit"),$submitQuickBtn=$("#commentquickform #textCommentSubmitQuick");$submit.attr("disabled",!1),$submitQuickBtn.attr("disabled",!1);var strLen=function(t){for(var e=0,o=0;o<t.length;o++){var i=t.charCodeAt(o);1<=i&&i<=126||65376<=i&&i<=65439?e++:e+=2}return e};$("#commentform").submit(function(){return""==$.trim($("#textareaComment").val())||$.trim($("#textareaComment").val())==$("#textareaComment").attr("default_data")?$("#error").is(":hidden")&&$("#error").html("您是不是忘了说点什么？").css("color","#f04848").slideDown().delay(3e3).slideUp():1e3<strLen($.trim($("#textareaComment").val()))?$("#error").is(":hidden")&&$("#error").html("评论内容不能多于1000个字符").css("color","#f04848").slideDown().delay(3e3).slideUp():submit_comment(0),!1}),$("#commentquickform").submit(function(){return""==$.trim($("#quickComment").val())||$.trim($("#quickComment").val())==$("#textareaComment").attr("default_data")?$("#quick_error").is(":hidden")&&$("#quick_error").html("您是不是忘了说点什么？").css("color","#f04848").slideDown().delay(3e3).slideUp():1e3<strLen($.trim($("#quickComment").val()))?$("#quick_error").is(":hidden")&&$("#quick_error").html("评论内容不能多于1000个字符").css("color","#f04848").slideDown().delay(3e3).slideUp():submit_comment(1),!1});var _time_slicing=10,wait=_time_slicing,submit_val=$submit.html(),waitquick=_time_slicing,quick_submit_val=$submitQuickBtn.html();function countdown(){0<wait?($submit.html(wait),wait--,setTimeout(countdown,1e3)):($submit.html(submit_val).attr("disabled",!1).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1),wait=_time_slicing)}function quickcountdown(){0<waitquick?($submitQuickBtn.html(waitquick),waitquick--,setTimeout(quickcountdown,1e3)):($submitQuickBtn.html(quick_submit_val).attr("disabled",!1).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1),waitquick=_time_slicing)}function count_down(t){var e=parseInt($(t).html());0<e&&($(t).html(e-1),setTimeout(function(){count_down(t)},1e3)),0==e&&($(".sub_Success").fadeOut(),$("#cover").fadeOut())}function submit_comment(isQuickSumit){var errorContainerId="error",btn=$submit,loadingImg=$("#loading"),submitUrl;if(1==isQuickSumit){var formObj=$("#commentquickform");errorContainerId="quick_error",btn=$submitQuickBtn,loadingImg=$("#loadingquick")}else var formObj=$("#commentform");submitUrl=0<$("#zhuanti_page_id").length&&0<$(".terminal_type").length&&"mobile"===$(".terminal_type").val()?zhiyou_relate.mBaseUrl:zhiyou_relate.baseUrl;var serverLogStr="",serverLogObj={client_type:getClientType(),event_key:"评论",cid:$("#data-cid").val()?$("#data-cid").val():"无",atp:$("#data-atp").val()?$("#data-atp").val():"无",tagID:$("#data-tagid").val()?$("#data-tagid").val():"无",p:"无",sourcePage:document.referrer?document.referrer:"无",sourceMode:"无"};$.each(serverLogObj,function(t,e){var o="&"+encodeURIComponent(t)+"="+encodeURIComponent(e);serverLogStr+=o}),btn.attr("disabled",!0).removeClass("btn_sub").addClass("btn_subGrey").fadeTo("slow",1),loadingImg.show(),$.ajax({url:submitUrl+"user/comment/ajax_set_comment",data:formObj.serialize()+serverLogStr,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(result.data&&(result.error_msg=result.data),loadingImg.hide(),10!=result.error_code)if(0==result.error_code){var div_new=$(".comment_wrap .tab_nav").find(".tab_comment_li:first");if(div_new.siblings().removeClass("current_item"),div_new.addClass("current_item"),$("#commentTabBlockNew").css("display",""),$("#commentTabBlockHot").css("display","none"),result.error_msg.sina_uri)return void(window.location.href=result.error_msg.sina_uri);var the_floor=0,floor_grey=$("#commentTabBlockNew ul.comment_listBox li:first .grey").html();floor_grey&&(the_floor=floor_grey.split("楼")[0]),the_floor=the_floor?parseInt(the_floor)+1:0;var ok_htm='\n<div id="success_1'+txt3+"</div>\n";6==result.error_code?ok_htm='\n<div id="success_1'+txt4+"</div>\n":8==result.error_code&&(ok_htm='\n<div id="success_1'+txt8+"</div>\n");var new_comment_html="";new_comment_html+='<li id="li_comment_4700621" class="comment_list">',new_comment_html+='<div class="comment_avatar">',new_comment_html+='<a href="javascript:void(0);" class="userPic"><img src="'+result.error_msg.head+'" width="36" height="36"/></a>',new_comment_html+=the_floor?'<span class="grey">'+the_floor+"楼</span>":"",new_comment_html+="</div>",new_comment_html+='<div class="comment_conBox">',new_comment_html+='<div class="comment_avatar_time"><div class="time">'+result.error_msg.format_date+"</div>",result.error_msg.is_anonymous?new_comment_html+='<span class="grey">'+result.error_msg.display_name+"</span>":new_comment_html+='<a href="javascript:void(0);" class="a_underline user_name">'+result.error_msg.display_name+"</a>",new_comment_html+="</div>",new_comment_html+='<div class="comment_conWrap">',new_comment_html+='<div class="comment_con"><p>'+result.error_msg.comment_content+"</p></div>",new_comment_html+=ok_htm,new_comment_html+='<div class="blankDiv"></div>',new_comment_html+="</div>",new_comment_html+="</div>",new_comment_html+='<div class="clear"></div>',new_comment_html+="</li>",$("#comment .tab_nav:first").css("display","block"),$("#li_comment_new").after(new_comment_html),setTimeout(function(){$("#success_1").remove()},3e3),1==isQuickSumit?quickcountdown():countdown(),1==isQuickSumit?$("#quickComment").val(""):$("#textareaComment").val(""),cancle_vote(),$(".commentNum").each(function(){$(this).html(parseInt($(this).html())+1)}),$("#quickComment").height("auto");var score=result.error_msg.post_points?result.error_msg.post_points:0,exp=result.error_msg.post_experience?result.error_msg.post_experience:0,gold=result.error_msg.post_gold?result.error_msg.post_gold:0,mana=result.error_msg.post_prestige?result.error_msg.post_prestige:0;if(0!=score||0!=exp||0!=gold||0!=mana){var scoreDom=0==score?"":'<span class="comment_score">积分：<em>'+score+"</em></span>",expDom=0==exp?"":'<span class="comment_exp">经验：<em>'+exp+"</em></span>",goldDom=0==gold?"":'<span class="comment_gold">金币：<em>'+gold+"</em></span>",manaDom=0==mana?"":'<span class="comment_mana">威望：<em>'+mana+"</em></span>";$("#pop-comment-score").find(".pop_comment_info").html(scoreDom+expDom+goldDom+manaDom),popUp("","#pop-comment-score","成功发表评论")}$("#"+errorContainerId).is(":hidden")&&$("#"+errorContainerId).html(ok_txt).css("color","green").slideDown().delay(3e3).slideUp()}else if(7==result.error_code){var msg=result.error_msg;$("body").append('<div class="pop pop_no_title" id="pop-scorenotenough"><i class="pop-close icon-cross-lighter">\x3c!--[if lt IE 8]>x<![endif]--\x3e</i><div class="pop-content oneLine"><i class="icon-logintanhao">\x3c!--[if lt IE 8]>404<![endif]--\x3e</i><p class="pop_info"></p></div></div>'),popUp("","#pop-scorenotenough",msg)}else{if(19==result.error_code)return void showCommentBind(result.error_code,formObj.serialize(),isQuickSumit);if(20==result.error_code)return void showCommentBind(result.error_code,formObj.serialize(),isQuickSumit);var no_htm=result.error_msg;5==result.error_code&&(no_htm="请登录后发表评论"),$("#"+errorContainerId).slideDown().html(no_htm),setTimeout(function(){btn.attr("disabled",!1).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1),$("#"+errorContainerId).slideUp()},3e3)}else result.error_msg.sina_uri?($("#pop-status-fail").find(".pop_info").html(txt10),$("#pop-status-fail").find(".icon-logintanhao").css({float:"left","margin-left":"15px","margin-top":"15px"}),$("#pop-status-fail").fadeIn(),$("#cover").fadeIn(),popPosition("#pop-status-fail"),count_down("#goback"),setTimeout(function(){window.location.href=result.error_msg.sina_uri},4e3)):setTimeout(function(){btn.attr("disabled",!1).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1),$("#"+errorContainerId).slideUp()},3e3)}})}func_atta(),func_report()}),function(c){c.fn.extend({insertContent:function(t,e){var o=c(this)[0];if(document.selection){this.focus();var i=document.selection.createRange();i.text=t,this.focus(),i.moveStart("character",-n);var a=i.text.length;if(2==arguments.length){var n=o.value.length;i.moveEnd("character",a+e),e<=0?i.moveStart("character",a-2*e-t.length):i.moveStart("character",a-e-t.length),i.select()}}else if(o.selectionStart||"0"==o.selectionStart){var r=o.selectionStart,s=o.selectionEnd,l=o.scrollTop;o.value=o.value.substring(0,r)+t+o.value.substring(s,o.value.length),this.focus(),o.selectionStart=r+t.length,o.selectionEnd=r+t.length,o.scrollTop=l,2==arguments.length&&(o.setSelectionRange(r-e,o.selectionEnd+e),this.focus())}else this.value+=t,this.focus()}})}(jQuery);var comment_tpl={item:'<blockquote class="comment_blockquote" blockquote_cid="{comment_id}"><div class="comment_floor">{depth}</div><div class="comment_conWrap"><div class="comment_con">{user_display_name}</div><div class="comment_action"><a class="jubao" href="javascript:void(0);" id="report_{comment_id}">举报</a><a class="dingNum {ding_class}" href="javascript:void(0);" id="cdc_support_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 1, {comment_id}, {article_id}, {li_comment_id});">顶<span>({up_num})</span></a><a class="caiNum" href="javascript:void(0);" id="cdc_oppose_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 0, {comment_id}, {article_id}, {li_comment_id});">踩<span>({down_num})</span></a>{atta}<a class="reply" href="javascript:void(0);" id="cdc_reply_{comment_id}">回复</a></div><div class="blankDiv"></div></div></blockquote>',item_no_atta_reply:'<blockquote class="comment_blockquote" blockquote_cid="{comment_id}"><div class="comment_floor">{depth}</div><div class="comment_conWrap"><div class="comment_con">{user_display_name}</div><div class="comment_action"><a class="jubao" href="javascript:void(0);" id="report_{comment_id}">举报</a><a class="dingNum {ding_class}" href="javascript:void(0);" id="cdc_support_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 1, {comment_id}, {article_id}, {li_comment_id});">顶<span>({up_num})</span></a><a class="caiNum" href="javascript:void(0);" id="cdc_oppose_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 0, {comment_id}, {article_id}, {li_comment_id});">踩<span>({down_num})</span></a></div><div class="blankDiv"></div></div></blockquote>'};function show_floors(a,n,r,s,l){if(a&&null!=typeof a&&r&&null!=typeof r&&("New"==r||"Hot"==r)){null==typeof l&&(l=1);var c=$("#commentTabBlock"+r+" #li_comment_"+a+" .blockquote_wrap");c.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);">加载中，请稍候。。。</a>'),n&&null!=typeof n&&s&&null!=typeof s||c.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);">网络错误，请刷新重试</a>');var d=$("#quickReply"),m=$("#is_bgm").val();$.ajax({type:"GET",url:zhiyou_relate.baseUrl+"user/comment/ajax_show_floors",data:"comment_id="+a+"&article_id="+n+"&channel_id="+s,dataType:"jsonp",jsonp:"callback",success:function(e){if(0<e.error_code)c.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);" onclick="show_floors('+a+","+n+", '"+r+"', '"+s+"', "+l+')">网络错误，请重试</a>');else{if(l)var t=comment_tpl.item;else t=comment_tpl.item_no_atta_reply;var o=new StringBuilder("").onMultiAppendBefore(function(t){t.li_comment_id=e.data.li_comment_id,t.article_id=e.data.article_id,t.channel_id=e.data.channel_id,t.user_display_name="",t.atta="",t.home_ta?t.user_display_name='<a class="a_underline user_name" target="_blank" href="'+t.home_ta+'" usmzdmid="'+t.smzdm_id+'">'+t.display_name+t.post_author+"</a>：<p>"+t.content+"</p>":t.user_display_name='<span class="grey">'+t.display_name+t.post_author+"</span>：<p>"+t.content+"</p>",1!=t.is_anonymous&&(t.atta='<a class="atta" href="javascript:void(0);" title="@'+t.display_name+'">@TA</a>')}).appendMultiFormat(t,e.data.comment_rows).toString();c.html(o),visibleOrNot(".operate_box",".noGoods","visibility"),visibleOrNot("blockquote",".comment_action","display"),commentQuickReply(c.find(".reply")),m&&null!=typeof m&&0<c.find("blockquote").length&&c.find("blockquote").each(function(){var t=$(this).attr("blockquote_cid"),e=$(this).find(".user_name:first").attr("usmzdmid"),o='<a href="http://users.bgm.smzdm.com/blackroom/user_add?smzdm_id='+e+'" title="关小黑屋" target="_blank">关小黑屋</a>';0!=e&&null!=e||(o="");var i='<a href="javascript:void(0);" title="打码" onclick="mosaic_show_textarea('+t+')">打码</a>'+o+('<a href="javascript:void(0);" onclick="delete_comment_confirm('+t+')" title="删除">删除</a>')+('<a href="http://comments.bgm.smzdm.com/comments/info/'+t+'" title="编辑" target="_blank">编辑</a>');$(this).find(".dingNum:last").before(i)});var i=$("#quickReplyDiv");""==$.trim(i.html())&&(d.find("#parentid").val(0),i.html(d)),init_comment_rating("#li_comment_"+a+" .blockquote_wrap"),func_atta("#li_comment_"+a+" .blockquote_wrap"),func_report("#li_comment_"+a+" .blockquote_wrap")}}})}else popUp("","#pop-status-fail","网络错误！")}function mosaic_show_textarea(cid){$("#pop-mosaic").remove();var article_id=$.trim($("#commentform #pid").val()),channel_id=$.trim($("#commentform #type").val());return $.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_content/",data:"comment_id="+cid+"&article_id="+article_id,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(0!=result.error_code)return alert(result.error_msg),!1;var old_content=result.data,html_txt='<div class="pop pop_main_box" id="pop-mosaic" style="display:block;margin-left:-240px;margin-top:-138px;"><i class="pop-close icon-cross-lighter">\x3c!--[if lt IE 8]>x<![endif]--\x3e</i><div class="pop-title"><div class="pop_name">打码</div></div><div class="pop-content"><div class="pop_width_420"><form id="commentform_'+cid+'"><input type="hidden" name="comment_id" value="'+cid+'" readonly="readonly" /><input type="hidden" name="article_id" value="'+article_id+'" readonly="readonly" /><input type="hidden" name="channel_id" value="'+channel_id+'" readonly="readonly" /><textarea name="old_content" id="old_content" readonly="readonly" style="display:none;">'+old_content+'</textarea><textarea name="content" id="txt_content_'+cid+'" class="textarea" id="mosaic-textarea" cols="60" rows="5">'+old_content+'</textarea><div class="a_blockBox"><a href="javascript:void(0);" class="a_redBlock" id="mosaicbtn_'+cid+'" onclick="mosaic_comment('+cid+')">打&nbsp;&nbsp;码</a></div></form></div></div></div>',cover=$("#cover");return cover.css("display","block"),cover.click(function(){$(this).hide(),$("#pop-mosaic").hide()}),$("#comment").after(html_txt),$("#pop-mosaic").delegate(".pop-close","click",function(){$("#pop-mosaic").hide(),cover.css("display","none")}),!0},error:function(){alert("网络错误")}}),!0}function get_select_txt(t){var e=document.getElementById(t),o="";if(document.selection){var i=document.selection.createRange();0<i.text.length&&(o=i.text)}else if(e.selectionStart||"0"==e.selectionStart){var a=e.selectionStart,n=e.selectionEnd;a!=n&&(o=e.value.substring(a,n))}return o}function mosaic_comment(cid){var mosaic_pre="〖「【《",mosaic_suf="》】」〗",mosaic_btn=$("#mosaicbtn_"+cid),txt_obj=$("#txt_content_"+cid);txt_obj.attr("disabled","disabled"),mosaic_btn.attr("disabled","disabled").html("打码中");var con=$.trim(txt_obj.val()),old_con=con,have_mosaic=0<=con.indexOf(mosaic_pre)||0<=con.indexOf(mosaic_suf),sel_txt=get_select_txt("txt_content_"+cid),con_len=strlen(con);if(900<con_len)return alert("该评论内容过长，请去后台操作"),txt_obj.removeAttr("disabled"),mosaic_btn.removeAttr("disabled").html("打码"),!1;if(sel_txt){var newcon=$.trim(txt_obj.val());if(0<=newcon.indexOf(mosaic_pre)||0<=newcon.indexOf(mosaic_suf)){if(!confirm("已经有打码内容，请注意不要嵌套打码"))return txt_obj.removeAttr("disabled"),mosaic_btn.removeAttr("disabled").html("打码"),!0;txt_obj.insertContent(mosaic_pre+sel_txt+mosaic_suf)}else txt_obj.insertContent(mosaic_pre+sel_txt+mosaic_suf)}else{var regObj={"〖「【《":"","》】」〗":""};for(reg in regObj)con=con.replace(new RegExp(reg,"g"),regObj[reg]);txt_obj.val(con)}return txt_obj.removeAttr("disabled"),mosaic_btn.removeAttr("disabled").html("打码"),$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_edit/",data:$("#commentform_"+cid).serialize(),dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(0!=result.error_code)return alert(result.error_msg),!1;$(".p_content_"+cid).html(result.data),$("#pop-mosaic").find("#old_content").val(con)},error:function(t){popUp("","#pop-status-fail","网络错误")}}),!0}function strlen(t){for(var e=0,o=0;o<t.length;o++){var i=t.charCodeAt(o);1<=i&&i<=126||65376<=i&&i<=65439?e++:e+=2}return e}function vote_by_post_comment(t,e,o){if(("os"==o||"exp"==o)&&vote_pid==e&&void 0!==t&&""!=t&&0!=t){var i=document.URL,a=smzdm_site_domain+"youhui/"+e;if(0<=i.indexOf(a)){var n=$("#respond").offset().top;$(window).scrollTop(n-300)}else setCookie(vote_id_cookie_key,t,30),setCookie(vote_type_cookie_key,o,30),window.open(a+"#comments","_blank");return show_vote_div(t,o),!1}}function show_vote_div(t,e){$("#vote_id").val(t),$("#vote_type").val(e);var o=$("#hidden_vote_div");o&&o.css("display","").html("");var i=$("#vote_"+e+"_"+t).html();return $("#hidden_vote_div").css("display","block").html('<div id="cdc_vote_div" class="voteDiv" style="margin: -5px 10px 10px 0px; color: rgb(187, 2, 0); padding-left: 74px; width: 610px; line-height: 1.6em;">请填写推荐理由，提交后即可为《'+i+"》投票。</div>"),!1}function cancle_vote(){$("#vote_id").attr("value",0),$("#vote_type").attr("value","");var t=$("#hidden_vote_div");t&&t.css("display","none").html("")}function formatDate(t){var e=t.getMonth()+1,o=t.getDate();return 1<=e&&e<=9&&(e="0"+e),0<=o&&o<=9&&(o="0"+o),t.getFullYear()+"-"+e+"-"+o+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}function tabCommon(t,e,o,i,a){"click"==a?$(t).delegate(e,"click",function(){$(this).addClass(i).siblings().removeClass(i),$(o).hide().eq($(t).find(e).index(this)).show()}):"hover"==a&&$(t).delegate(e,"mouseover",function(){$(this).addClass(i).siblings().removeClass(i),$(o).hide().eq($(t).find(e).index(this)).show()})}$(function(){tabCommon(".innerlink-title","span",".innerlink-content","active","hover")}),$(document).ready(function(){({init:function(){if(!$("#rewardOptions")[0]||!$("#rewardModule")[0])return!1;switch(this.articleId=$("#rewardOptions").attr("data-articleId"),this.autherId=$("#rewardOptions").attr("data-autherId"),this.avatarImg=$("#rewardOptions").attr("data-avatarImg"),this.autherName=$("#rewardOptions").attr("data-autherName"),this.channelId=$("#rewardOptions").attr("data-channelId"),this.articleTitle=$("#rewardOptions").attr("data-articleTitle")+"",this.client_type="PC",this.sourcePage=document.referrer?document.referrer:"无",this.atp=0<$("#data-atp").length?$("#data-atp").val():"无",this.tagID=0<$("#data-tagid").length?$("#data-tagid").val():"无",this.rewardOverTime=1==$("#rewardOptions").attr("data-rewardexpire"),this.channelText="",this.cache_text="",this.auther_call="",this.channelId){case"3":this.title="优惠很值，打赏犒劳爆料人一下",this.channelText="优惠",this.cache_text="爆料",this.auther_call="爆料人";break;default:this.title="文章很值，打赏犒劳作者一下",this.channelText="评测",this.cache_text="创作",this.auther_call="作者"}this.pageNum=10,this.avatarLength=5,this.topLength=3,this.jsonData(1),this.showPageNum=5,this.insertCss("//res.smzdm.com/resources/public/css/gratuity_plug.css")},jsonData:function(t){var e=this;$.ajax({url:"//zhiyou.smzdm.com/user/shang/jsonp_shang_list?channel_id="+e.channelId+"&article_id="+e.articleId+"&get_total=1&with_top=1&page="+t+"&limit="+e.pageNum,type:"get",dataType:"jsonp",jsonp:"callback",success:function(t){e.Data=t,e.insertDom(),e.inserAction()},error:function(t){console.log(t)}})},isElement:function(t){return void 0!==t&&1<=t.length},insertCss:function(e){try{document.createStyleSheet(e)}catch(t){var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href=e,document.getElementsByTagName("head")[0].appendChild(o)}},insertDom:function(){var d=this,m=[];"优惠"==this.channelText?m.push('<div class="reward-box" style="border:0">'):m.push('<div class="reward-box" >'),this.title=this.rewardOverTime?"该爆料已过打赏期限":this.title,m.push("<p>"+this.title+"</p>"),m.push("<div>"),$.ajax({url:"//zhiyou.smzdm.com/user/info/jsonp_get_current/",type:"get",dataType:"jsonp",jsonp:"callback",success:function(t){var e=""+zhiyou_relate.user_info.smzdm_id;if(d.autherId=""+d.autherId,e==d.autherId||d.rewardOverTime?m.push('<a class="reward-btn-no" href="javascript:void(0)">打赏</a>'):m.push('<a class="reward-btn" href="javascript:void(0)">打赏</a>'),0!=(t=d.Data.data).total){m.push('<ul class="reward-head-portrait">');for(var o=t.rows.length<=d.avatarLength?t.rows.length:d.avatarLength,i=0;i<o;i++){var a=t.rows[i].avatar,n=t.rows[i].nickname,r=t.rows[i].user_url,s=t.rows[i].beauty_time,l=t.rows[i].smzdm_id;m.push('<li><a href="'+r+'"><img id="'+l+'" src="'+a+'" name="'+n+'" time="'+s+'"></a></li>')}m.push("</ul>")}0==t.total?d.rewardOverTime||m.push('<span id="reward-list-msg" data-limit="10">“首席”打赏官正虚席以待！</span>'):10<t.total?m.push('<span>等<a class="gratuity-num">'+t.total+"</a>人已打赏</span>"):m.push('<span><a class="gratuity-num">'+t.total+"</a>人已打赏</span>"),m.push('<div class="clearfix"></div>'),m.push("</div>"),m.push("</div>");var c=m.join("");$("#rewardModule").html(c),$("#rewardModule").show(),$("article.general_bg").css("margin-bottom","0px"),$("#rewardModule").css("padding-top","10px")},error:function(t){console.log(t)}})},inserAction:function(){var _=this;function m(e,o){function t(){window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight);var t=$(e).height();$(o).css("top",(winHeight-t)/2+"px")}t(),window.onresize=t}function f(t,e){for(var o=e.rows.length,i=0;i<o&&!(i>=_.pageNum);i++){var a=e.rows[i].avatar,n=e.rows[i].nickname,r=e.rows[i].user_url,s=e.rows[i].beauty_time;t.push("<li>"),t.push('<a href="'+r+'" target="_blank">'),t.push('<img src="'+a+'">'),t.push("</a>"),t.push('<p><a href="'+r+'">'+n+"</a></p>"),t.push("<span>"+s+"</span>"),t.push("</li>")}return t}function i(u,t){var h=u||t,e=_.pageNum;$.ajax({url:"//zhiyou.smzdm.com/user/shang/jsonp_shang_list?channel_id="+_.channelId+"&article_id="+_.articleId+"&get_total=0&with_top=1&page="+h+"&limit="+e,type:"get",dataType:"jsonp",jsonp:"callback",success:function(t){var e=[];e=(e=f(e,t.data)).join(""),$("#gratuity-list-box div.pop-interval-30 ul.gratuity_list").html(e);var i=$("#gratuity-list-box ul.pagination"),o=i.find("li a.pageCurrent").attr("page"),a=i.find("li.pageup"),n=i.find("li.pagedown");function r(){var t=[];t.push('<li class="pageup"><span>&lt;</span><a>上一页</a></li>');for(var e=_.pageTotal>_.showPageNum?_.showPageNum:_.pageTotal,o=0;o<e;o++)t.push('<li><a page="'+(o+1)+'">'+(o+1)+"</a></li>");_.pageTotal>_.showPageNum&&t.push('<li><span class="dotStyle">...</span></li>'),t.push('<li class="pagedown"><a>下一页</a><span>&gt;</span></li>'),t.join(""),i.html(t)}if(i.find("li a.pageCurrent").removeClass("pageCurrent"),u)0<u&&u<=_.showPageNum&&(r(),1==u&&i.find(".pageup").remove(),u==_.pageTotal&&i.find(".pagedown").remove()),i.find('li a[page="'+u+'"]').addClass("pageCurrent");else{if(o<h){if(!a[0]){var s='<li class="pageup"><span>&lt;</span><a>上一页</a></li>';i.find("li").eq(0).before(s)}if(0<h&&h<=_.showPageNum&&_.pageTotal==h&&n.remove(),h>_.showPageNum&&h<=_.pageTotal){var l=i.find("li a[page]");h==_.showPageNum+1&&(l[1].outerHTML='<span class="dotStyle">...</span>',l=i.find("li a[page]"));for(var c=!1,d=0;d<l.length;d++)l.eq(d).attr("page")==h&&(c=!0);if(!c)for(var m=0;m<l.length;m++)if(1!=l.eq(m).attr("page")){var p=l.eq(m).attr("page");l.eq(m).attr("page",+p+1).html(+p+1)}return i.find('li a[page="'+h+'"]').addClass("pageCurrent"),_.pageTotal==h&&(n.remove(),i.find("li").eq(i.find("li").length-1).remove()),!1}}else if(h<o){if(_.showPageNum<h&&h<=+_.pageTotal-(_.showPageNum-2)){if(!n[0]){i.append('<li><span class="dotStyle">...</span></li>');s='<li class="pagedown"><a>下一页</a><span>&gt;</span></li>';i.append(s)}for(l=i.find("li a[page]"),c=!1,d=0;d<l.length;d++)l.eq(d).attr("page")==h&&(c=!0);if(!c)for(m=0;m<l.length;m++)if(1!=l.eq(m).attr("page")){p=l.eq(m).attr("page");l.eq(m).attr("page",+p-1).html(+p-1)}}0<h&&h<=_.showPageNum&&(r(),1==h&&i.find(".pageup").remove())}i.find('li a[page="'+h+'"]').addClass("pageCurrent")}},error:function(t){console.log(t)}})}$("body").on("mouseover",".reward-head-portrait li",function(){var t=document.createElement("div");t.className="head-name";var e=$(this).find("img").attr("name"),o=$(this).find("img").attr("time");t.innerHTML="<em></em><p>"+e+'</p><p class="time">'+o+"</p>",t.style.top="-64px",$(this).append(t);var i=$(".head-name").width()/2;$(".head-name").css("left",0-i-5+"px"),$(".head-name").find("em").css("left",i+10+"px")}),$("body").on("mouseout",".reward-head-portrait li",function(){$(this).find("div.head-name").remove()}),$("body").on("click",".reward-btn",function(){$.ajax({url:"//zhiyou.smzdm.com/user/info/jsonp_get_current/",type:"get",dataType:"jsonp",jsonp:"callback",success:function(t){var c=t;if(0==c.smzdm_id)return $("#pop-login-new").show(),$("#cover").show(),$("#zhiyou_login_window_iframe").attr("src",zhiyou_relate.iframe_url),!1;var e=[];e.push('<div class="pop pop_main_box" id="gratuity">'),e.push('<i class="pop-close icon-cross-lighter">\x3c!--[if lt IE 8]>x<![endif]--\x3e</i>'),e.push('<div class="pop-title">'),e.push('<div class="pop_name">打赏</div>'),e.push("</div>"),e.push('<div class="pop-content" style="padding-bottom:0">'),e.push('<div class="pop-interval-30">'),e.push('<div class="pop-slogan">'),e.push('<a href="http://zhiyou.smzdm.com/member/'+_.autherId+'"><img class="pop-slogan-img" src="'+_.avatarImg+'"></a> 您的支持将鼓励我继续'+_.cache_text+"！"),e.push("</div>"),e.push('<div class="gratuity-process">'),e.push('<div class="gratuity-option">'),e.push('<span class="pop_jubao">'),e.push('<input type="radio" checked="" class="normal" id="broken_silver" name="report">'),e.push('<label for="broken_silver" class="color-gray"><span>碎银子</span>（余额 '+c.silver+"）</label>"),e.push("</span>"),e.push('<span class="pop_jubao">'),e.push('<input type="radio" class="normal" id="gold" name="report">'),e.push('<label for="gold" class="color-gray"><span>金币</span>（余额 '+c.gold+"）</label>"),e.push("</span>"),e.push("</div>"),e.push("打赏数额"),e.push('<div class="broken_silver gratuity-option-box">'),e.push('<div class="gratuity-price">'),e.push("<ul>"),e.push('<li value="10">10碎银子</li>'),e.push('<li value="50">50碎银子</li>'),e.push('<li value="100">100碎银子</li>'),e.push("</ul>"),e.push('<input class="custom" value="" placeholder="可输入10的倍数">'),e.push("<span>碎银子</span>"),e.push('<div class="clear"></div>'),e.push("</div>"),e.push("</div>"),e.push('<div class="gold gratuity-option-box">'),e.push('<div class="gratuity-price">'),e.push("<ul>"),e.push('<li value="1">1金币</li>'),e.push('<li value="5">5金币</li>'),e.push('<li value="10">10金币</li>'),e.push("</ul>"),e.push('<input class="custom" value="" placeholder="输入数字为整数">'),e.push("<span>金币</span>"),e.push('<div class="clear"></div>'),e.push("</div>"),e.push("</div>"),e.push('<p class="color-gray">注：碎银子将以10:1的比例转为金币送给'+_.auther_call+"</p>"),e.push("</div>"),e.push('<div class="gratuity-success">');var o=25<_.articleTitle.length?_.articleTitle.substr(0,25)+"...":_.articleTitle;e.push("<p> 即将对"+_.channelText+"的"+_.auther_call+" "+_.autherName+" 的文章《"+o+'》进行打赏。<br><span class="gratuityOver"></span></p>'),e.push("</div>"),e.push('<a href="javascript:void(0)" class="a_redBlock gratuity-btn">打&nbsp;&nbsp;赏</a>'),e.push('<a href="javascript:void(0)" class="a_redBlock gratuity-ok" style="display:none">确&nbsp;&nbsp;认</a>'),e.push('<div class="pop_msg_error"></div>'),e.push("</div>"),e.push("</div>"),e.push("</div>"),$("#cover")[0]||e.push('<div id="cover"></div>');var i=e.join("");$("body").append(i),$("#cover").show(),$("#gratuity").show(),m("#gratuity","#gratuity");var r={broken_silver:0,gold:0};0<c.silver?($(".broken_silver ul").find("li").eq(0).addClass("hover"),r.broken_silver=parseInt($(".broken_silver ul").find("li").eq(0).attr("value"))):0==c.silver&&0<c.gold?($("#gold").attr("checked","checked"),$(".gold.gratuity-option-box").show(),$(".broken_silver.gratuity-option-box").hide(),$(".gold ul").find("li").eq(0).addClass("hover"),r.gold=parseInt($(".gold ul").find("li").eq(0).attr("value"))):0==c.silver&&0==c.gold&&(r.broken_silver=parseInt($(".broken_silver ul").find("li").eq(0).attr("value")),$(".gratuity-btn").attr("class","a_greyBlock  gratuity-btn"));var a=function(){$(".gratuity-price ul li").removeClass("hover"),$("#gratuity input.custom").removeClass("input-error")};$(".gratuity-option span.pop_jubao").click(function(){0==this.getElementsByTagName("input")[0].checked&&(this.getElementsByTagName("input")[0].checked="checked");var t=$(this).find("input").attr("id"),e=function(t,e){c[t]>e?$(".gratuity-btn").attr("class","a_redBlock gratuity-btn"):$(".gratuity-btn").attr("class","a_greyBlock gratuity-btn")};r={broken_silver:0,gold:0},$("#gratuity input.custom").val(""),"broken_silver"==t?($(".gratuity-option-box").hide(),$(".broken_silver").show(),a(),$(".broken_silver ul").find("li").eq(0).addClass("hover"),r.broken_silver=parseInt($(".broken_silver ul").find("li").eq(0).attr("value")),$(".pop_msg_error").html(""),e("silver",10)):($(".gratuity-option-box").hide(),$(".gold").show(),a(),$(".gold ul").find("li").eq(0).addClass("hover"),r.gold=parseInt($(".gold ul").find("li").eq(0).attr("value")),$(".pop_msg_error").html(""),e("gold",1))});var n=function(){return $('.gratuity-option input[name="report"]:checked ').attr("id")};$(".gratuity-price ul li").click(function(){a(),$(this).addClass("hover"),(r={broken_silver:0,gold:0})[n()]=$(this).attr("value"),$(".pop_msg_error").html(""),$(".custom").val("");$(".custom");var t=$(".pop_msg_error"),e=$(".gratuity-btn");"broken_silver"==n()?+$(this).attr("value")>+c.silver?(t.html("碎银子不足，您可以换个姿势打赏"),e.attr("class","a_greyBlock  gratuity-btn")):(t.html(""),e.attr("class","a_redBlock gratuity-btn")):+$(this).attr("value")>+c.gold?(t.html("金币不足，您可以换个姿势打赏"),e.attr("class","a_greyBlock  gratuity-btn")):(t.html(""),e.attr("class","a_redBlock gratuity-btn"))}),$(".gratuity-price input.custom").focus(function(){a(),r={broken_silver:0,gold:0}});var s=+c.silver,l=+c.gold;$(".gratuity-price input.custom").change(function(){var t=$(".custom"),e=$(".pop_msg_error"),o=$(".gratuity-btn");if($(".pop_msg_error").html(""),$(".gratuity-btn").attr("class","a_redBlock gratuity-btn"),""!=this.value){var i=n();if("broken_silver"==i){if(this.value>s)return t.addClass("input-error"),e.html("碎银子不足，您可以换个姿势打赏"),o.attr("class","a_greyBlock  gratuity-btn"),!1;if(0==this.value)return t.addClass("input-error"),e.html("碎银子打赏只支持10的倍数哦"),o.attr("class","a_greyBlock  gratuity-btn"),!1;var a=parseInt(this.value,10);if(a%10!=0)return t.addClass("input-error"),e.html("碎银子打赏只支持10的倍数哦"),o.attr("class","a_greyBlock  gratuity-btn"),!1;r.broken_silver=a,o.attr("class","a_redBlock gratuity-btn"),t.removeClass("input-error")}else if("gold"==i){if(this.value>l)return t.addClass("input-error"),e.html("余额不足，您可以换个姿势打赏"),o.attr("class","a_greyBlock  gratuity-btn"),!1;if(!/^[1-9]+[0-9]*]*$/.test(this.value))return t.addClass("input-error"),e.html("金币打赏值只支持整数哦"),o.attr("class","a_greyBlock  gratuity-btn"),!1;r.gold=parseInt(this.value,10),o.attr("class","a_redBlock gratuity-btn"),t.removeClass("input-error")}}else t.addClass("input-error"),e.html("请输入打赏金额！"),o.attr("class","a_greyBlock  gratuity-btn")}),$(".gratuity-price input.custom").blur(function(){""==this.value&&($(".pop_msg_error").html("请输入打赏金额！"),$(".gratuity-btn").attr("class","a_greyBlock  gratuity-btn"))}),$(".gratuity-btn").click(function(){if(-1<$(this).attr("class").indexOf("a_redBlock")){for(var t in r)if(console.log("1==",r[t]),0!=r[t]){var e=+r[t],o=0!=r.broken_silver?2:1;$(".gratuity-btn").hide(),$(".gratuity-ok").css("display","block"),$(".gratuity-process").hide(),$(".gratuity-success").show(),2==o?$("span.gratuityOver").html("打赏"+e+"碎银子，"+_.auther_call+"将收到"+e/10+"金币"):1==o&&$("span.gratuityOver").html("打赏"+e+"金币，"+_.auther_call+"将收到"+e+"金币"),$(".security-input").val(""),$(".pop_msg_error").html("");var i,a=+c.shang.day_has_shang_gold,n=+c.shang.day_shang_gold_limit;if(2==o&&(e=+e/10),+c.shang.day_shang_per_gold_limit<e||n<=a+e)$("input.security-input")[0]||$(".gratuity-success").append('<div><input type="text" value="" placeholder="请输入安全码" class="security-input"></div>'),$(".gratuity-ok").attr("class","a_redBlock gratuity-ok"),i=c.is_set_safepass?'<a target="_blank" href="http://zhiyou.smzdm.com/user/find_password/">忘记安全密码？</a>':'没有设置安全密码(<a target="_blank" href="http://zhiyou.smzdm.com/user/safepass/">设置安全密码</a>)',$(".pop_msg_error").html(i);return!1}$(".pop_msg_error").html("您还没有选择打赏金额！")}}),$(".a_redBlock.gratuity-ok").click(function(){if(-1<$(this).attr("class").indexOf("a_redBlock")){var e="",t=function(){for(var t in r)if(0!=r[t])return e=r[t],"broken_silver"==t?2:1}(),o="";if($(".security-input")[0]&&""==(o=$(".security-input")[0].value))return $("#gratuity .pop_msg_error").html('请输入安全密码(<a href="http://zhiyou.smzdm.com/user/find_password/" target="_blank">忘记安全密码</a>)'),!1;$.ajax({url:"//zhiyou.smzdm.com/user/shang/jsonp_shang?style="+t+"&coin="+e+"&channel_id="+_.channelId+"&article_id="+_.articleId+"&safepass="+o+"&client_type="+_.client_type+"&sourcePage="+_.sourcePage+"&atp="+_.atp+"&tagID="+_.tagID,dataType:"jsonp",jsonp:"callback",success:function(t){if(0==t.error_code){$("#gratuity").remove();var e,o=[];if("优惠"==_.channelText?e=30:"评测"==_.channelText&&(e=40),o.push('<div class="pop pop_no_title gratuityOk" style="width: 300px; text-align: center; padding:'+e+'px 0;">'),o.push('<i class="pop-close icon-cross-lighter">\x3c!--[if lt IE 8]>x<![endif]--\x3e</i>'),o.push('<div class="pop_jubao oneLine">'),o.push('<i class="icon-loginright">\x3c!--[if lt IE 8]>√<![endif]--\x3e</i>'),o.push('<p class="pop_info">打赏成功</p>'),o.push("</div>"),o.push("</div>"),o=o.join(""),$("body").append(o),$("div.gratuityOk").show(),$(".reward-head-portrait")[0]){(l=[]).push("<li>"),l.push('<a href="http://zhiyou.smzdm.com/member/'+c.smzdm_id+'/" _orighref="http://zhiyou.smzdm.com/member/'+c.smzdm_id+'/" _tkworked="true">'),l.push('<img id="'+c.smzdm_id+'" src="'+c.avatar+'" name="'+c.nickname+'" time="刚刚">'),l.push("</a>"),l.push("</li>"),l=l.join("");for(var i=$(".reward-head-portrait li").length,a=!1,n=0;n<i;n++)$(".reward-head-portrait").find("li").eq(n).find("img").attr("id")==c.smzdm_id&&(a=!0);if(a){$("#"+c.smzdm_id).parents("li").remove();var r=$(".reward-head-portrait").html();$(".reward-head-portrait").html(l+r)}else{i>=_.avatarLength&&$(".reward-head-portrait").find("li").eq(i-1).remove(),$(".reward-head-portrait").find("li").eq(0).before(l);var s=+$("a.gratuity-num").html();$("a.gratuity-num").html(s+1),$("a.reward-top span").html(s+1)}}else{var l;(l=[]).push('<ul class="reward-head-portrait">'),l.push("<li>"),l.push('<a href="http://zhiyou.smzdm.com/member/'+c.smzdm_id+'/" _orighref="http://zhiyou.smzdm.com/member/'+c.smzdm_id+'/" _tkworked="true">'),l.push('<img src="'+c.avatar+'" name="'+c.nickname+'" time="刚刚">'),l.push("</a>"),l.push("</li>"),l.push("</ul>"),l.push('<span><a class="gratuity-num" _hover-ignore="1" _orighref="" _tkworked="true">1</a>人已打赏</span>'),l=l.join(""),$(".reward-btn").after(l),$("span#reward-list-msg").remove(),$("a.reward-top span").html("1")}$(".reward-head-portrait li").hover(function(){var t=document.createElement("div");t.className="head-name";var e=$(this).find("img").attr("name"),o=$(this).find("img").attr("time");t.innerHTML="<em></em><p>"+e+'</p><p class="time">'+o+"</p>",t.style.top="-64px",$(this).append(t);var i=$(".head-name").width()/2;$(".head-name").css("left",0-i-5+"px"),$(".head-name").find("em").css("left",i+10+"px")},function(){$(this).find("div.head-name").remove()}),$("body").on("click","div.gratuityOk i",function(){$(this).parent().remove()}),m("#gratuity-list-box","div.gratuityOk"),setTimeout(function(){$("div.gratuityOk").remove(),$("#cover").hide()},2e3)}else $(".pop_msg_error").html(t.error_msg)},error:function(t){console.log(t)},complete:function(t,e){"timeout"==e&&$("#gratuity .pop_msg_error").html("很抱歉，网络出了点小差，您可以再试")}})}});$("body").on("click","span.back_gratuity",function(){$(".gratuity-success").hide(),$(".gratuity-process").show(),$(".gratuity-option-box").hide(),$(".broken_silver").show(),$(".gratuity-btn").show(),$(".gratuity-ok").hide(),$(".pop_msg_error").html(""),$(".custom").val(""),a(),$(".gratuity-process ul").find("li").eq(0).addClass("hover"),$(".pop_jubao input").attr("checked",!1),document.getElementById("broken_silver").checked="checked"})},error:function(t){console.log(t)}})}),$("body").on("click",".gratuity-num",function(){$.ajax({url:"//zhiyou.smzdm.com/user/shang/jsonp_shang_list?channel_id="+_.channelId+"&article_id="+_.articleId+"&get_total=1&with_top=1&page=1&limit="+_.pageNum,type:"get",dataType:"jsonp",jsonp:"callback",success:function(t){_.Data=t;var e=_.Data.top_list,o=_.Data.data,i=[];if(i.push('<div class="pop pop_main_box" id="gratuity-list-box">'),i.push('<i class="pop-close icon-cross-lighter">\x3c!--[if lt IE 8]>x<![endif]--\x3e</i>'),i.push('<div class="pop-title">'),i.push('<div class="pop_name">'+o.total+"人已对本文进行打赏</div>"),i.push("</div>"),i.push('<div class="pop-content" style="padding-bottom:0">'),i.push('<div class="pop-interval-30">'),0!=e.length&&10<=o.total){_.pageNum=5,i.push('<div class="gratuity_list_new">TOP 打赏</div>'),i.push('<ul class="gratuity_list_top">');for(var a=e.length>_.topLength?_.topLength:e.length,n=0;n<a;n++){i.push("<li>"),i.push('<span class="sort_value">'+(n+1)+"</span>"),i.push('<a href="'+e[n].user_url+'" target="_blank">'),i.push('<img src="'+e[n].avatar+'">'),i.push("</a>"),i.push('<span class="sort_txt"><a href="'+e[n].user_url+'">'+e[n].nickname+"</a></span>");var r=0==e[n].total_silver?"":"<span>"+e[n].total_silver+"</span> 碎银子　",s=0==e[n].total_gold?"":"<span>"+e[n].total_gold+"</span> 金币";i.push('<span class="gratuity_txt">打赏：'+r+s+"</span>"),i.push("</li>")}i.push("</ul>")}if(i.push('<div class="gratuity_list_new">最新打赏</div>'),i.push('<ul class="gratuity_list">'),(i=f(i,o)).push("</ul>"),i.push("</div>"),o.total>_.pageNum){i.push('<ul class="pagination">'),_.pageTotal=o.total%_.pageNum==0?o.total/_.pageNum:parseInt(o.total/_.pageNum,10)+1;for(var l=_.pageTotal>_.showPageNum?_.showPageNum:_.pageTotal,c=0;c<l;c++)0==c?i.push('<li><a class="pageCurrent" page="'+(c+1)+'">'+(c+1)+"</a></li>"):i.push('<li><a page="'+(c+1)+'">'+(c+1)+"</a></li>");1<_.pageTotal&&(_.pageTotal>_.showPageNum&&i.push('<li><span class="dotStyle">...</span></li>'),i.push('<li class="pagedown"><a>下一页</a><span>&gt;</span></li>')),i.push("</ul>")}i.push("</div>"),i.push("</div>");var d=i.join("");$("body").append(d),$("#cover")[0]||$("body").append('<div id="cover"></div>'),$("#cover").show(),$("#gratuity-list-box").show(),m("#gratuity-list-box","#gratuity-list-box")},error:function(t){console.log(t)}})}),$("body").on("click","#gratuity-list-box ul.pagination li a",function(){var t=$("#gratuity-list-box ul.pagination li a.pageCurrent").attr("page"),e=$(this).attr("page"),o=$(this).parent().attr("class");e&&null==o?t!=e&&i(e):e||"pagedown"!=o?e||"pageup"!=o||i(null,+t-1):i(null,+t+1)});for(var t=["#gratuity-list-box","#gratuity","div.gratuityOk"],e=0;e<t.length;e++)$("body").on("click",t[e]+" i.pop-close",function(){$(this).parent().remove(),$("#cover").hide()});$("body").on("click","#cover",function(){$("#gratuity-list-box")[0]&&$("#gratuity-list-box").remove(),$("#gratuity")[0]&&$("#gratuity").remove(),$("div.gratuityOk")[0]&&$("div.gratuityOk").remove(),$(this).hide()})}}).init()});var HISTROY_NAME="s_his",HIS_DOMAIN=".smzdm.com";function focusAjaxRequest(t,e,o){$.extend(t,{type:o.data("type")+"",keyword:o.data("cate")}),$.ajax({type:"get",url:"//zhiyou.smzdm.com/guanzhu/jsonp_follow",dataType:"jsonp",jsonp:"callback",data:t,success:function(t){e(t,o)},error:function(t){console.log(t),clickUnlock()}})}function focusAjaxCallback(o,i){return function(t,e){clickUnlock(),0===t.error_code?"ok"===t.data?(e.attr("data-follow",""+i),e.html(o)):console.log(t.error_msg):1===t.error_code?"用户未登录"===t.error_msg?$(".J_login_trigger").trigger("click"):popUp("",".J_focus_pop",t.error_msg,!1):2===t.error_code&&popUp("",".J_focus_pop","关注数量超出限制，<br/>请先删除部分内容再尝试",!1)}}function focusMouseEvent(t,e){"user"===e.data("type")?"2"===e.attr("data-follow")&&e.html(t):"1"===e.attr("data-follow")&&e.html(t)}function clickUnlock(){$(document).off("click",".J_user_focus"),$(document).on("click",".J_user_focus",clickLock())}function clickLock(){return function(t){t.preventDefault(),$(document).off("click",".J_user_focus"),$(document).on("click",".J_user_focus",function(t){t.preventDefault()});var e,o,i=$(this);"user"===i.data("type")?focusAjaxRequest({follow:o="1"===i.attr("data-follow")?1:"2"===i.attr("data-follow")?0:1},focusAjaxCallback(e=0===o?"<i>+</i>关注":"取消关注",0===o?1:2),i):0===location.hostname.indexOf("wiki")?(e=0===(o=1===parseInt(i.attr("data-follow"))?0:1)?'<i class="icon-zhikujiahao"></i><span><i class="collect_msg">关注</i></span>':'<span><i class="collect_msg">取消关注</i></span>',console.log(e),focusAjaxRequest({follow:o},focusAjaxCallback(e,o),i)):focusAjaxRequest({follow:o=1===parseInt(i.attr("data-follow"))?0:1},focusAjaxCallback(e=0===o?"<i>+</i>关注":"取消关注",o),i)}}function isFocusAjaxRequest(t,e,o){$.ajax({type:"get",url:"//zhiyou.smzdm.com/guanzhu/jsonp_is_followed",dataType:"jsonp",jsonp:"callback",data:t,success:function(t){e(t),o()},error:function(t){console.log(t),clickUnlock()}})}function user_foucs_callback(t){0!=t.smzdm_id?$(function(){var t=$(".J_user_focus");$(".J_focus_pop");if(t.length){var e=[];$.each(t,function(t,o){if("user"!=$(o).data("type")&&0!==$(o).parents(".meta-tags").length){var i={type:$(o).data("type"),keyword:$(o).data("cate")};$(o).parents(".meta-tags").on("mouseenter",function(){var e=$(this);$(o).hide();$(o).parents(".meta-tags").find(".J_focus_loading").length||$(o).parents(".meta-tags").children("div").append('<img class="J_focus_loading" src="http://res.smzdm.com/pc/v1.0/dist/img/loading.gif" style="vertical-align:-3px;display:inline;margin:auto 5px;">'),timeout=setTimeout(function(){isFocusAjaxRequest(i,function(t){e.off("mouseenter"),0===t.error_code?($(o).parents(".meta-tags").find(".J_focus_loading").remove(),$(o).show(),$(o).attr("data-follow",""+t.data.followed),1===t.data.followed?$(o).html("已关注"):$(o).html("<i>+</i>关注")):console.log(t.error_msg)},function(){clickUnlock()})},200)}).on("mouseleave",function(){timeout&&clearTimeout(timeout)})}else 0===$(o).parents(".meta-tags").length?e.push({type:$(o).data("type"),keyword:$(o).data("cate")}):e.push({type:"user",keyword:$(o).data("cate")})});var o={keywords:e};0<e.length&&isFocusAjaxRequest(o,function(t){0===t.error_code?$.each(t.data,function(t,e){var o='[data-type="'+e.type+'"][data-cate="'+e.keyword+'"]';$(o).attr("data-follow",""+e.followed),"user"===e.type?2===e.followed?$(o).html("已关注"):1===e.followed?$(o).html("<i>+</i>关注"):0===e.followed&&$(o).hide():0===location.hostname.indexOf("wiki")?1===e.followed?$(o).html('<span><i class="collect_msg">已关注</i></span>'):0===e.followed&&$(o).html('<i class="icon-zhikujiahao"></i><span><i class="collect_msg">关注</i></span>'):1===e.followed?$(o).html("已关注"):0===e.followed&&$(o).html('<i class="">+</i>关注')}):console.log(t.error_msg)},function(){t.length&&(0===location.hostname.indexOf("wiki")?(t.css("padding","1px").on("mouseenter",function(){focusMouseEvent('<span><i class="collect_msg">取消关注</i></span>',$(this))}),t.css("padding","1px").on("mouseleave",function(){focusMouseEvent('<span><i class="collect_msg">已关注</i></span>',$(this))})):(t.on("mouseenter",function(){focusMouseEvent("取消关注",$(this))}),t.on("mouseleave",function(){focusMouseEvent("已关注",$(this))})),$(document).on("click",".J_user_focus",clickLock()))})}}):$(function(){$(".J_user_focus").on("click",function(){$(".J_login_trigger").trigger("click")})})}$(function(){var s=$('header form input[type="search"]'),r=s.closest("form").css("position","relative");function a(t){var e,o,i,a,n=(e=t,o=$("<div/>",{class:"s-history"}),i=$(['<div class="s-history-head">','<span class="grey">最近搜过</span><a href="javascript:;" onclick=\'dataLayer.push('+JSON.stringify({event:"站内搜索_历史搜索_清空"})+");'>删除历史</a>","</div>"].join("")),a=l(e),o.append(i).append(a));n.css("top",s.parent().outerHeight()),r.addClass("show-history").append(n),$(document).bind("click",function(t){c()}),r.on("click",function(t){t.stopPropagation()}),n.on("click",".s-history-head>a",function(t){deleteCookie(HISTROY_NAME),n.find(".s-history-list li").remove(),c()}),n.on("click","li>.J_his_remove",function(t){var e=$(this).parent("li"),o=decodeURIComponent(e.attr("data-val"));t.preventDefault(),t.stopPropagation(),deleteCookieInArr(HISTROY_NAME,o),e.remove()}),n.on("click",".s-history-list>li>a",function(t){var e=decodeURIComponent($(this).parent().attr("data-val"));s.val(e),r.append('<input type="hidden" name="source" value="his">'),r.trigger("submit")})}function l(t){var r=$("<ul>",{class:"s-history-list"});return $.each(t,function(t,e){var o={event:"站内搜索_历史搜索_点击","搜索字词":e},i={event:"站内搜索_历史搜索_删除","搜索字词":e},a=e;20<e.length&&(a=e.substr(0,20)+"...");var n=$("<li/>").attr("data-val",encodeURIComponent(e));n.append($("<a/>",{href:"javascript:;",onclick:"dataLayer.push("+JSON.stringify(o)+")"}).text(a)).append($("<span/>",{class:"J_his_remove",onclick:"dataLayer.push("+JSON.stringify(i)+")"}).html("&times;")),r.prepend(n)}),r}function c(){var t=r.find(".s-history");r.removeClass("show-history"),t.length&&(t.hide(),t.find(".s-history-list>li.focus").removeClass("focus"))}function o(){var t=getCookie(HISTROY_NAME),e=r.find(".s-history");if(t&&0!==t.length){var o,i=t.split(",");r.addClass("show-history"),e.length?(o=l(i),r.find(".s-history .s-history-list").replaceWith(o),e.show()):a(i)}}"2.smzdm.com"==location.hostname?s.css("color","#fff"):s.css("color","#333"),$("header").on("submit","form",function(t){var e=$(this),i=$('input[name="default_keywords"]').val(),a=s.attr("name"),o=$.trim(s.val());if(0<o.length)return function(t){var e=getCookie(HISTROY_NAME);if(e){var o=e.split(","),i=$.inArray(t,o);-1<i&&o.splice(i,1),10<=o.length&&o.splice(0,1),setCookie(HISTROY_NAME,o.join(","),null,"/",HIS_DOMAIN)}setCookieInArr(HISTROY_NAME,t,null,"/",HIS_DOMAIN)}(o),!0;if(t.preventDefault(),0===$.trim(i).length)return!1;var n=e.serializeArray(),r="";$.each(n,function(t,e){var o=0===t?"":"&";e.name==a&&(e.value=i),r+=o+e.name+"="+e.value}),window.location=e.get(0).action+"?"+r}),s.attr("autocomplete","off"),s.focus(function(t){var e=getCookie(HISTROY_NAME);!s.val().length&&e&&o()}).keyup(function(t){37<=t.keyCode&&t.keyCode<=40&&t.preventDefault()}).keydown(function(t){var e;r.hasClass("show-history")&&(37<=t.keyCode&&t.keyCode<=40?t.preventDefault():13===t.keyCode&&(t.preventDefault(),s.val().length&&(e=s.val(),window.dataLayer&&window.dataLayer.push({event:"站内搜索_历史搜索_点击","搜索字词":e}))))}).bind("input propertychange",function(){s.val().length?c():o()}),$(document).keyup(function(t){var n=r.find(".s-history");if(!n.length||n.is(":hidden")||-1===$.inArray(t.keyCode,[13,37,38,39,40]))return!0;t.preventDefault(),t.stopPropagation();var e=n.find(".s-history-list"),o=e.find("li.focus");switch(t.keyCode){case 13:r.append('<input type="hidden" name="source" value="his">'),r.trigger("submit");break;case 37:c();break;case 38:o.length?i(e.find("li.focus").index()-1):i(e.find("li").length-1);break;case 39:n.is(":visible")&&s.val().length&&(r.append('<input type="hidden" name="source" value="his">'),r.trigger("submit"));break;case 40:o.length?i(e.find("li.focus").index()+1):i(0)}function i(t){var e=n.find(".s-history-list"),o=e.find("li.focus"),i=e.children().length-1;t=t<0?i:i<t?0:t,o.removeClass("focus");var a=decodeURIComponent(e.children().eq(t).addClass("focus").attr("data-val"));s.val(a)}})}),$(function(){var t;(t=$(".J_youhui_tips")).length&&"1"!==getCookie("is_first_youhui")&&(t.show(),$(document).on("click",".J_youhui_tips i",function(){t.hide(),setCookie("is_first_youhui","1",999999999,"/")})),(t=$(".J_post_tips")).length&&"1"!==getCookie("is_first_post")&&(t.show(),$(document).on("click",".J_post_tips i",function(){t.hide(),setCookie("is_first_post","1",999999999,"/")}))}),$(document).ready(function(){var t=navigator.userAgent.toLowerCase(),e={},o=/(msie|firefox|chrome|opera|version|crios).*?([\d.]+)/;if(null!=t.match(o)){var i=t.match(o);e.ver=i[2];var a=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),n=navigator.userAgent.indexOf("QQBrowser");if(a&&parseInt(e.ver)<=54&&"object"==typeof navigator.credentials&&n<0&&!getCookie("chrome_v")){var r="<div class='chrtips-wrap'><p>检测到您的 chrome 浏览器版本不是最新版，为了您的安全浏览和支付购买，请您升级 chrome 浏览器到最新版。<a href='' target='_blank'>去升级</a></p><span class='chrtips-close'>&times</span></div>";$("#global-nav").height();function s(){$(".chrtips-close").on("click",function(){zhiyou_relate.setCookie("chrome_v","1",86400,"/",".smzdm.com",!1),$(".chrtips-wrap").remove()});var t=parseInt($("#global-nav .nav-inner").css("width"))-2;$(".chrtips-wrap").css({width:t}),"Mac"==function(){navigator.userAgent;var t="Win32"==navigator.platform||"Windows"==navigator.platform;if("Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform)return"Mac";if(t)return"Windows"}()?$(".chrtips-wrap a").attr("href","http://rj.baidu.com/soft/detail/25718.html?ald"):$(".chrtips-wrap a").attr("href","http://rj.baidu.com/soft/detail/14744.html")}$("#global-nav .nav-inner").length?($("#global-nav .nav-inner").append(r),s()):$(window).load(function(){$("#global-nav .nav-inner").append(r),s()})}}});var commonShare={init:function(){window.clientType=this.getClientType(),window.postLogData=this.postData,this.initDom(),this.closePop()},initDom:function(){var n=this;n.$weibo=$(".icon-weibo-noframe"),n.$qq=$(".icon-qq"),n.$qzone=$(".icon-qqzone"),n.$douban=$(".icon-douban"),n.$drawer=$(".icon-drawer"),n.$sharelist=$(".common-share-list"),n.url=encodeURIComponent(document.URL.replace(/#comments/g,"")),n.title=encodeURIComponent(document.title);var r,s;n.$sharelist.length&&(n.$sharelist.find("i").each(function(t,e){var o=$(this).prop("class"),i=document.domain,a=document.URL;switch($("#articleIdBang").val()?r=$("#articleIdBang").val():"wiki"===i.split(".")[0]?r=a.split("/")[4]:"test"===i.split(".")[0]&&"yanzheng"===a.split("/")[3]?r=a.split("/")[4]:(r=a.split("/p/")[1])&&(r=r.substring(0,r.length-1)),o){case"icon-weibo-noframe":s="微博",n.$weibo.parent().attr({href:"http://v.t.sina.com.cn/share/share.php?url="+n.url+"&title="+n.title,onclick:"window.dataLayer.push({'event': '900003', '渠道': '"+s+"', '文章ID': '"+r+"'});window.postLogData();"});break;case"icon-qqzone":s="QQ空间",n.$qzone.parent().attr({href:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+n.url+"&title="+n.title,onclick:"window.dataLayer.push({'event': '900003', '渠道': '"+s+"', '文章ID': '"+r+"'});window.postLogData();"});break;case"icon-qq":s="QQ",n.$qq.parent().attr({href:"http://connect.qq.com/widget/shareqq/index.html?url="+n.url+"&title="+n.title,onclick:"window.dataLayer.push({'event': '900003', '渠道': '"+s+"', '文章ID': '"+r+"'});window.postLogData();"});break;case"icon-douban":s="豆瓣",n.$douban.parent().attr({href:"https://www.douban.com/share/service?href="+n.url+"&name="+n.title,onclick:"window.dataLayer.push({'event': '900003', '渠道': '"+s+"', '文章ID': '"+r+"'});window.postLogData();"});break;case"icon-drawer":s="抽屉",n.$drawer.parent().attr({href:"https://dig.chouti.com/digg.action?newsURL="+n.url+"&title="+n.title,onclick:"window.dataLayer.push({'event': '900003', '渠道': '"+s+"', '文章ID': '"+r+"'});window.postLogData();"})}}),n.$sharelist.find('a:not(".icon-wechat")').attr({target:"_blank"}),$(".J_qrcode").attr("data-src",document.URL).each(function(t,e){var o=$(e),i=o.attr("data-src"),a=Number(e.width),n=Number(e.height),r=e.parentNode;o.remove();new QRCode(r,{text:i,width:a,height:n,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L,showTitle:!1})}),$(".J_common_shares").click(function(t){$(".J_share_dropdown").hide(),$(this).parent().find(".J_share_dropdown").toggle()}).parent().click(function(t){t.stopPropagation()}))},closePop:function(){$("body").on("click",function(t){$(".J_share_dropdown").hide()})},postData:function(){$.ajax({type:"get",url:"//zhiyou.smzdm.com/share/log",data:{client_type:window.clientType,user_id:getCookie("smzdm_id")?getCookie("smzdm_id"):"无",aid:0<$("#data-aid").length?$("#data-aid").val():"无",cid:0<$("#data-cid").length?$("#data-cid").val():"无",atp:0<$("#data-atp").length?$("#data-atp").val():"无",tagID:0<$("#data-tagid").length?$("#data-tagid").val():"无",sourcePage:document.referrer?document.referrer:"无"},dataType:"jsonp",jsonp:"callback",success:function(t){console.log(t)},error:function(){}})},getClientType:function(){var t=navigator.userAgent;return/smzdmapp/i.test(t)?/(Android)/i.test(t)?"android":"iphone":/(Android)|i(Phone|Pad|Pod|OS)/i.test(t)?"WAP":"PC"}};function detailAddEditButton(){var t=parseInt($("#channelID").val()),e=editUrlFilter(t,parseInt($("#articleID").val()),parseInt($("#J_article_id").val()));isNaN(t)?$(".link_box .operate_box").append('<span class="edit_interface"><a href="'+e+'" target="_blank">编辑</a></span>'):$(".article_meta:first, article .item-name").append('<span class="edit_interface"><a href="'+e+'" target="_blank">编辑</a></span>')}$(function(){$(".J_share_dropdown").length&&commonShare.init()});var publicbgm="Ymdt",sellbgm="eW91aHVpLmJnbQ==",postbgm="cG9zdC5iZ20=",wikibgm="YmFpa2UtYmdt",artibgm="YXJ0aWNsZS1iZ20=",base64=new Base64;function decodeURL(t){return base64.decode(t)}function changeURL(t,e){return t.replace(/\d+/i,decodeURL(e))}function editUrlFilter(t,e,o){var i="http://"+Math.floor(1e5*Math.random())+".smzdm.com/edit_youhui/"+e,a="http://"+Math.floor(1e5*Math.random())+".smzdm.com/edit/"+e,n="http://"+Math.floor(1e5*Math.random())+".smzdm.com/edit/"+e,r="http://"+Math.floor(1e5*Math.random())+".smzdm.com/edit_wiki/"+o;if(isNaN(t))editLink=changeURL(r,wikibgm);else switch(t){case 1:case 3:editLink=changeURL(i,sellbgm);break;case 6:editLink=changeURL(a,artibgm);break;case 11:editLink=changeURL(n,artibgm);break;default:editLink=""}return editLink}function addEditInterface(t){if(null!=t.attr("articleid")){var e=t.attr("articleid").split("_"),o=parseInt(e[0]),i=parseInt(e[1]),a=t.find(".lrTop"),n=editUrlFilter(o,i);0==t.find(".lrTop").length&&(2!=o&&3!=o||(a=t.find(".itemUserInfo"))),a.append('<span class="edit_interface"><a href="'+n+'" target="_blank">编辑</a></span>')}}function listAddEditButton(){$(".list").each(function(){0==$(this).find(".edit_interface").length&&addEditInterface($(this))})}function Base64(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encode=function(t){var e,o,i,a,n,r,s,l="",c=0;for(t=_utf8_encode(t);c<t.length;)a=(e=t.charCodeAt(c++))>>2,n=(3&e)<<4|(o=t.charCodeAt(c++))>>4,r=(15&o)<<2|(i=t.charCodeAt(c++))>>6,s=63&i,isNaN(o)?r=s=64:isNaN(i)&&(s=64),l=l+_keyStr.charAt(a)+_keyStr.charAt(n)+_keyStr.charAt(r)+_keyStr.charAt(s);return l},this.decode=function(t){var e,o,i,a,n,r,s="",l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)e=_keyStr.indexOf(t.charAt(l++))<<2|(a=_keyStr.indexOf(t.charAt(l++)))>>4,o=(15&a)<<4|(n=_keyStr.indexOf(t.charAt(l++)))>>2,i=(3&n)<<6|(r=_keyStr.indexOf(t.charAt(l++))),s+=String.fromCharCode(e),64!=n&&(s+=String.fromCharCode(o)),64!=r&&(s+=String.fromCharCode(i));return s=_utf8_decode(s)},_utf8_encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",o=0;o<t.length;o++){var i=t.charCodeAt(o);i<128?e+=String.fromCharCode(i):(127<i&&i<2048?e+=String.fromCharCode(i>>6|192):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128)),e+=String.fromCharCode(63&i|128))}return e},_utf8_decode=function(t){for(var e="",o=0,i=c1=c2=0;o<t.length;)(i=t.charCodeAt(o))<128?(e+=String.fromCharCode(i),o++):191<i&&i<224?(c2=t.charCodeAt(o+1),e+=String.fromCharCode((31&i)<<6|63&c2),o+=2):(c2=t.charCodeAt(o+1),c3=t.charCodeAt(o+2),e+=String.fromCharCode((15&i)<<12|(63&c2)<<6|63&c3),o+=3);return e}}var $doc=$(document),isInitFooter=!1;$(function(){var i=$("#J_back_top"),a=$("#footer"),n=$(window).height(),r=i.parent().hasClass("J_index_elevator")?$():i.parent(),l=$("#feed-wrap"),c=l.length?l.offset().top:0,e=$("#feed-side>div").last(),o=(e=e.hasClass("J_side_scroll_fixed")?e.add(e.prev("div")):$("#feed-side>div").last()).length?e.first().position().top:0,d=$("#feed-side").length?$("#feed-side").position().top:0,m=$("#global-nav").height(),t=$("#feed-main").height(),s=$("#feed-side").length?$("#feed-side").height():0,p=0<t-s&&l.length&&e.length;function u(s,t){o+d-m<s?e.each(function(t,e){var o,i,a,n,r=$(e);r.hasClass("fixed")?(o=s,i=$("#feed-side > div.fixed"),a=m+h(i),n=l.height(),c+n<o+a?i.each(function(t,e){var o=$(e);o.hasClass("abs")||(o.data("prev-style",o.attr("style")),o.css({position:"absolute",top:n-o.height()-h(o.nextAll(".fixed"))}).addClass("abs"))}):i.each(function(t,e){var o=$(e);o.hasClass("abs")&&o.attr("style",o.data("prev-style")).removeClass("abs").removeData("prev-style")})):(fixedHeight=m+h(r.prevAll("div.fixed")),r.css({position:"fixed",top:fixedHeight}).addClass("fixed").after($('<div class="side-placeholder" />').css({height:r.height(),"z-index":10})))}):e.each(function(t,e){var o=$(e);o.hasClass("fixed")&&o.css({position:"",top:""}).removeClass("fixed").next(".side-placeholder").remove()})}function h(t){var o=0;return $.each(t,function(t,e){o+=$(e).height()}),o}function _(){var t=document.body.scrollHeight,e=window.innerHeight||document.documentElement.clientHeight;isInitFooter?e-278<t?(isInitFooter=!1,$("#footer").attr("style","position:relative!important;"),$("#elevator").css("bottom","30px")):(isInitFooter=!0,$("#footer").attr("style","position:fixed!important;bottom:0;"),$("#elevator").css("bottom","308px")):e<t?(isInitFooter=!1,$("#footer").attr("style","position:relative!important;"),$("#elevator").css("bottom","30px")):(isInitFooter=!0,$("#footer").attr("style","position:fixed!important;bottom:0;"),$("#elevator").css("bottom","308px"))}a.append(r),$("#feed-main-list").bind("feedload leftHeightChange",function(){setTimeout(function(){t=$("#feed-main").height(),p=0<t-s,e.length&&u($(document).scrollTop(),a.position().top)},0)}),0<$("#footer").length&&$(window).scroll(function(t){var e=$doc.scrollTop(),o=a.position().top;0<e?i.addClass("show"):i.removeClass("show"),o-n<e?r.addClass("fixed-footer"):r.removeClass("fixed-footer"),p&&(d=$("#feed-side").position().top,c=l.length?l.offset().top:0,u(e,o))}),i.on("click","a",function(t){t.preventDefault(),$("html, body").animate({scrollTop:0},300)}),_(),$(window).resize(function(){_()}),$(document).on("click",".J_smart_kefu",function(t){t.preventDefault(),$.ajax({type:"GET",url:"//zhiyou.smzdm.com/user/info/jsonp_get_current",dataType:"jsonp",xhrFields:{withCredentials:!0},success:function(t){0===t.smzdm_id?$(window).width()<=480?zhiyou_relate.getClient()?window.webkit.messageHandlers.call_client_login.postMessage(null):"function"==typeof call_client_login?call_client_login():$(".J_login_trigger").trigger("click"):$(".J_login_trigger").trigger("click"):(ysf.logoff(),ysf.config({robotShuntSwitch:1,uid:t.qyuid,name:t.nickname,staffid:t.qiyu_group_info.staffid,groupid:t.qiyu_group_info.groupid,data:JSON.stringify([{key:"real_name",hidden:"true"},{key:"mobile_phone",hidden:"true"},{key:"email",hidden:"true"},{type:"crm_param",key:"qytoken",value:t.qytoken}]),success:function(){$(window).width()<=480?window.location.href=ysf.url():window.open(ysf.url(),"_blank")},error:function(){}}))},error:function(t){console.log(t)}})})});